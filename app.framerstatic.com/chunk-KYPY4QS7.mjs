function v(i){this.content=i}v.prototype={constructor:v,find:function(i){for(var e=0;e<this.content.length;e+=2)if(this.content[e]===i)return e;return-1},get:function(i){var e=this.find(i);return e==-1?void 0:this.content[e+1]},update:function(i,e,t){var n=t&&t!=i?this.remove(t):this,r=n.find(i),s=n.content.slice();return r==-1?s.push(t||i,e):(s[r+1]=e,t&&(s[r]=t)),new v(s)},remove:function(i){var e=this.find(i);if(e==-1)return this;var t=this.content.slice();return t.splice(e,2),new v(t)},addToStart:function(i,e){return new v([i,e].concat(this.remove(i).content))},addToEnd:function(i,e){var t=this.remove(i).content.slice();return t.push(i,e),new v(t)},addBefore:function(i,e,t){var n=this.remove(e),r=n.content.slice(),s=n.find(i);return r.splice(s==-1?r.length:s,0,e,t),new v(r)},forEach:function(i){for(var e=0;e<this.content.length;e+=2)i(this.content[e],this.content[e+1])},prepend:function(i){return i=v.from(i),i.size?new v(i.content.concat(this.subtract(i).content)):this},append:function(i){return i=v.from(i),i.size?new v(this.subtract(i).content.concat(i.content)):this},subtract:function(i){var e=this;i=v.from(i);for(var t=0;t<i.content.length;t+=2)e=e.remove(i.content[t]);return e},toObject:function(){var i={};return this.forEach(function(e,t){i[e]=t}),i},get size(){return this.content.length>>1}};v.from=function(i){if(i instanceof v)return i;var e=[];if(i)for(var t in i)e.push(t,i[t]);return new v(e)};var fe=v;function Qe(i,e,t){for(let n=0;;n++){if(n==i.childCount||n==e.childCount)return i.childCount==e.childCount?null:t;let r=i.child(n),s=e.child(n);if(r==s){t+=r.nodeSize;continue}if(!r.sameMarkup(s))return t;if(r.isText&&r.text!=s.text){for(let l=0;r.text[l]==s.text[l];l++)t++;return t}if(r.content.size||s.content.size){let l=Qe(r.content,s.content,t+1);if(l!=null)return l}t+=r.nodeSize}}function Xe(i,e,t,n){for(let r=i.childCount,s=e.childCount;;){if(r==0||s==0)return r==s?null:{a:t,b:n};let l=i.child(--r),o=e.child(--s),h=l.nodeSize;if(l==o){t-=h,n-=h;continue}if(!l.sameMarkup(o))return{a:t,b:n};if(l.isText&&l.text!=o.text){let a=0,c=Math.min(l.text.length,o.text.length);for(;a<c&&l.text[l.text.length-a-1]==o.text[o.text.length-a-1];)a++,t--,n--;return{a:t,b:n}}if(l.content.size||o.content.size){let a=Xe(l.content,o.content,t-1,n-1);if(a)return a}t-=h,n-=h}}var p=class i{constructor(e,t){if(this.content=e,this.size=t||0,t==null)for(let n=0;n<e.length;n++)this.size+=e[n].nodeSize}nodesBetween(e,t,n,r=0,s){for(let l=0,o=0;o<t;l++){let h=this.content[l],a=o+h.nodeSize;if(a>e&&n(h,r+o,s||null,l)!==!1&&h.content.size){let c=o+1;h.nodesBetween(Math.max(0,e-c),Math.min(h.content.size,t-c),n,r+c)}o=a}}descendants(e){this.nodesBetween(0,this.size,e)}textBetween(e,t,n,r){let s="",l=!0;return this.nodesBetween(e,t,(o,h)=>{let a=o.isText?o.text.slice(Math.max(e,h)-h,t-h):o.isLeaf?r?typeof r=="function"?r(o):r:o.type.spec.leafText?o.type.spec.leafText(o):"":"";o.isBlock&&(o.isLeaf&&a||o.isTextblock)&&n&&(l?l=!1:s+=n),s+=a},0),s}append(e){if(!e.size)return this;if(!this.size)return e;let t=this.lastChild,n=e.firstChild,r=this.content.slice(),s=0;for(t.isText&&t.sameMarkup(n)&&(r[r.length-1]=t.withText(t.text+n.text),s=1);s<e.content.length;s++)r.push(e.content[s]);return new i(r,this.size+e.size)}cut(e,t=this.size){if(e==0&&t==this.size)return this;let n=[],r=0;if(t>e)for(let s=0,l=0;l<t;s++){let o=this.content[s],h=l+o.nodeSize;h>e&&((l<e||h>t)&&(o.isText?o=o.cut(Math.max(0,e-l),Math.min(o.text.length,t-l)):o=o.cut(Math.max(0,e-l-1),Math.min(o.content.size,t-l-1))),n.push(o),r+=o.nodeSize),l=h}return new i(n,r)}cutByIndex(e,t){return e==t?i.empty:e==0&&t==this.content.length?this:new i(this.content.slice(e,t))}replaceChild(e,t){let n=this.content[e];if(n==t)return this;let r=this.content.slice(),s=this.size+t.nodeSize-n.nodeSize;return r[e]=t,new i(r,s)}addToStart(e){return new i([e].concat(this.content),this.size+e.nodeSize)}addToEnd(e){return new i(this.content.concat(e),this.size+e.nodeSize)}eq(e){if(this.content.length!=e.content.length)return!1;for(let t=0;t<this.content.length;t++)if(!this.content[t].eq(e.content[t]))return!1;return!0}get firstChild(){return this.content.length?this.content[0]:null}get lastChild(){return this.content.length?this.content[this.content.length-1]:null}get childCount(){return this.content.length}child(e){let t=this.content[e];if(!t)throw new RangeError("Index "+e+" out of range for "+this);return t}maybeChild(e){return this.content[e]||null}forEach(e){for(let t=0,n=0;t<this.content.length;t++){let r=this.content[t];e(r,n,t),n+=r.nodeSize}}findDiffStart(e,t=0){return Qe(this,e,t)}findDiffEnd(e,t=this.size,n=e.size){return Xe(this,e,t,n)}findIndex(e){if(e==0)return $(0,e);if(e==this.size)return $(this.content.length,e);if(e>this.size||e<0)throw new RangeError(`Position ${e} outside of fragment (${this})`);for(let t=0,n=0;;t++){let r=this.child(t),s=n+r.nodeSize;if(s>=e)return s==e?$(t+1,s):$(t,n);n=s}}toString(){return"<"+this.toStringInner()+">"}toStringInner(){return this.content.join(", ")}toJSON(){return this.content.length?this.content.map(e=>e.toJSON()):null}static fromJSON(e,t){if(!t)return i.empty;if(!Array.isArray(t))throw new RangeError("Invalid input for Fragment.fromJSON");return new i(t.map(e.nodeFromJSON))}static fromArray(e){if(!e.length)return i.empty;let t,n=0;for(let r=0;r<e.length;r++){let s=e[r];n+=s.nodeSize,r&&s.isText&&e[r-1].sameMarkup(s)?(t||(t=e.slice(0,r)),t[t.length-1]=s.withText(t[t.length-1].text+s.text)):t&&t.push(s)}return new i(t||e,n)}static from(e){if(!e)return i.empty;if(e instanceof i)return e;if(Array.isArray(e))return this.fromArray(e);if(e.attrs)return new i([e],e.nodeSize);throw new RangeError("Can not convert "+e+" to a Fragment"+(e.nodesBetween?" (looks like multiple versions of prosemirror-model were loaded)":""))}};p.empty=new p([],0);var ue={index:0,offset:0};function $(i,e){return ue.index=i,ue.offset=e,ue}function ee(i,e){if(i===e)return!0;if(!(i&&typeof i=="object")||!(e&&typeof e=="object"))return!1;let t=Array.isArray(i);if(Array.isArray(e)!=t)return!1;if(t){if(i.length!=e.length)return!1;for(let n=0;n<i.length;n++)if(!ee(i[n],e[n]))return!1}else{for(let n in i)if(!(n in e)||!ee(i[n],e[n]))return!1;for(let n in e)if(!(n in i))return!1}return!0}var w=class i{constructor(e,t){this.type=e,this.attrs=t}addToSet(e){let t,n=!1;for(let r=0;r<e.length;r++){let s=e[r];if(this.eq(s))return e;if(this.type.excludes(s.type))t||(t=e.slice(0,r));else{if(s.type.excludes(this.type))return e;!n&&s.type.rank>this.type.rank&&(t||(t=e.slice(0,r)),t.push(this),n=!0),t&&t.push(s)}}return t||(t=e.slice()),n||t.push(this),t}removeFromSet(e){for(let t=0;t<e.length;t++)if(this.eq(e[t]))return e.slice(0,t).concat(e.slice(t+1));return e}isInSet(e){for(let t=0;t<e.length;t++)if(this.eq(e[t]))return!0;return!1}eq(e){return this==e||this.type==e.type&&ee(this.attrs,e.attrs)}toJSON(){let e={type:this.type.name};for(let t in this.attrs){e.attrs=this.attrs;break}return e}static fromJSON(e,t){if(!t)throw new RangeError("Invalid input for Mark.fromJSON");let n=e.marks[t.type];if(!n)throw new RangeError(`There is no mark type ${t.type} in this schema`);let r=n.create(t.attrs);return n.checkAttrs(r.attrs),r}static sameSet(e,t){if(e==t)return!0;if(e.length!=t.length)return!1;for(let n=0;n<e.length;n++)if(!e[n].eq(t[n]))return!1;return!0}static setFrom(e){if(!e||Array.isArray(e)&&e.length==0)return i.none;if(e instanceof i)return[e];let t=e.slice();return t.sort((n,r)=>n.type.rank-r.type.rank),t}};w.none=[];var A=class extends Error{},g=class i{constructor(e,t,n){this.content=e,this.openStart=t,this.openEnd=n}get size(){return this.content.size-this.openStart-this.openEnd}insertAt(e,t){let n=Ze(this.content,e+this.openStart,t);return n&&new i(n,this.openStart,this.openEnd)}removeBetween(e,t){return new i(Ye(this.content,e+this.openStart,t+this.openStart),this.openStart,this.openEnd)}eq(e){return this.content.eq(e.content)&&this.openStart==e.openStart&&this.openEnd==e.openEnd}toString(){return this.content+"("+this.openStart+","+this.openEnd+")"}toJSON(){if(!this.content.size)return null;let e={content:this.content.toJSON()};return this.openStart>0&&(e.openStart=this.openStart),this.openEnd>0&&(e.openEnd=this.openEnd),e}static fromJSON(e,t){if(!t)return i.empty;let n=t.openStart||0,r=t.openEnd||0;if(typeof n!="number"||typeof r!="number")throw new RangeError("Invalid input for Slice.fromJSON");return new i(p.fromJSON(e,t.content),n,r)}static maxOpen(e,t=!0){let n=0,r=0;for(let s=e.firstChild;s&&!s.isLeaf&&(t||!s.type.spec.isolating);s=s.firstChild)n++;for(let s=e.lastChild;s&&!s.isLeaf&&(t||!s.type.spec.isolating);s=s.lastChild)r++;return new i(e,n,r)}};g.empty=new g(p.empty,0,0);function Ye(i,e,t){let{index:n,offset:r}=i.findIndex(e),s=i.maybeChild(n),{index:l,offset:o}=i.findIndex(t);if(r==e||s.isText){if(o!=t&&!i.child(l).isText)throw new RangeError("Removing non-flat range");return i.cut(0,e).append(i.cut(t))}if(n!=l)throw new RangeError("Removing non-flat range");return i.replaceChild(n,s.copy(Ye(s.content,e-r-1,t-r-1)))}function Ze(i,e,t,n){let{index:r,offset:s}=i.findIndex(e),l=i.maybeChild(r);if(s==e||l.isText)return n&&!n.canReplace(r,r,t)?null:i.cut(0,e).append(t).append(i.cut(e));let o=Ze(l.content,e-s-1,t,l);return o&&i.replaceChild(r,l.copy(o))}function Jt(i,e,t){if(t.openStart>i.depth)throw new A("Inserted content deeper than insertion position");if(i.depth-t.openStart!=e.depth-t.openEnd)throw new A("Inconsistent open depths");return je(i,e,t,0)}function je(i,e,t,n){let r=i.index(n),s=i.node(n);if(r==e.index(n)&&n<i.depth-t.openStart){let l=je(i,e,t,n+1);return s.copy(s.content.replaceChild(r,l))}else if(t.content.size)if(!t.openStart&&!t.openEnd&&i.depth==n&&e.depth==n){let l=i.parent,o=l.content;return I(l,o.cut(0,i.parentOffset).append(t.content).append(o.cut(e.parentOffset)))}else{let{start:l,end:o}=Dt(t,i);return I(s,_e(i,l,o,e,n))}else return I(s,te(i,e,n))}function $e(i,e){if(!e.type.compatibleContent(i.type))throw new A("Cannot join "+e.type.name+" onto "+i.type.name)}function de(i,e,t){let n=i.node(t);return $e(n,e.node(t)),n}function R(i,e){let t=e.length-1;t>=0&&i.isText&&i.sameMarkup(e[t])?e[t]=i.withText(e[t].text+i.text):e.push(i)}function q(i,e,t,n){let r=(e||i).node(t),s=0,l=e?e.index(t):r.childCount;i&&(s=i.index(t),i.depth>t?s++:i.textOffset&&(R(i.nodeAfter,n),s++));for(let o=s;o<l;o++)R(r.child(o),n);e&&e.depth==t&&e.textOffset&&R(e.nodeBefore,n)}function I(i,e){return i.type.checkContent(e),i.copy(e)}function _e(i,e,t,n,r){let s=i.depth>r&&de(i,e,r+1),l=n.depth>r&&de(t,n,r+1),o=[];return q(null,i,r,o),s&&l&&e.index(r)==t.index(r)?($e(s,l),R(I(s,_e(i,e,t,n,r+1)),o)):(s&&R(I(s,te(i,e,r+1)),o),q(e,t,r,o),l&&R(I(l,te(t,n,r+1)),o)),q(n,null,r,o),new p(o)}function te(i,e,t){let n=[];if(q(null,i,t,n),i.depth>t){let r=de(i,e,t+1);R(I(r,te(i,e,t+1)),n)}return q(e,null,t,n),new p(n)}function Dt(i,e){let t=e.depth-i.openStart,r=e.node(t).copy(i.content);for(let s=t-1;s>=0;s--)r=e.node(s).copy(p.from(r));return{start:r.resolveNoCache(i.openStart+t),end:r.resolveNoCache(r.content.size-i.openEnd-t)}}var ne=class i{constructor(e,t,n){this.pos=e,this.path=t,this.parentOffset=n,this.depth=t.length/3-1}resolveDepth(e){return e==null?this.depth:e<0?this.depth+e:e}get parent(){return this.node(this.depth)}get doc(){return this.node(0)}node(e){return this.path[this.resolveDepth(e)*3]}index(e){return this.path[this.resolveDepth(e)*3+1]}indexAfter(e){return e=this.resolveDepth(e),this.index(e)+(e==this.depth&&!this.textOffset?0:1)}start(e){return e=this.resolveDepth(e),e==0?0:this.path[e*3-1]+1}end(e){return e=this.resolveDepth(e),this.start(e)+this.node(e).content.size}before(e){if(e=this.resolveDepth(e),!e)throw new RangeError("There is no position before the top-level node");return e==this.depth+1?this.pos:this.path[e*3-1]}after(e){if(e=this.resolveDepth(e),!e)throw new RangeError("There is no position after the top-level node");return e==this.depth+1?this.pos:this.path[e*3-1]+this.path[e*3].nodeSize}get textOffset(){return this.pos-this.path[this.path.length-1]}get nodeAfter(){let e=this.parent,t=this.index(this.depth);if(t==e.childCount)return null;let n=this.pos-this.path[this.path.length-1],r=e.child(t);return n?e.child(t).cut(n):r}get nodeBefore(){let e=this.index(this.depth),t=this.pos-this.path[this.path.length-1];return t?this.parent.child(e).cut(0,t):e==0?null:this.parent.child(e-1)}posAtIndex(e,t){t=this.resolveDepth(t);let n=this.path[t*3],r=t==0?0:this.path[t*3-1]+1;for(let s=0;s<e;s++)r+=n.child(s).nodeSize;return r}marks(){let e=this.parent,t=this.index();if(e.content.size==0)return w.none;if(this.textOffset)return e.child(t).marks;let n=e.maybeChild(t-1),r=e.maybeChild(t);if(!n){let o=n;n=r,r=o}let s=n.marks;for(var l=0;l<s.length;l++)s[l].type.spec.inclusive===!1&&(!r||!s[l].isInSet(r.marks))&&(s=s[l--].removeFromSet(s));return s}marksAcross(e){let t=this.parent.maybeChild(this.index());if(!t||!t.isInline)return null;let n=t.marks,r=e.parent.maybeChild(e.index());for(var s=0;s<n.length;s++)n[s].type.spec.inclusive===!1&&(!r||!n[s].isInSet(r.marks))&&(n=n[s--].removeFromSet(n));return n}sharedDepth(e){for(let t=this.depth;t>0;t--)if(this.start(t)<=e&&this.end(t)>=e)return t;return 0}blockRange(e=this,t){if(e.pos<this.pos)return e.blockRange(this);for(let n=this.depth-(this.parent.inlineContent||this.pos==e.pos?1:0);n>=0;n--)if(e.pos<=this.end(n)&&(!t||t(this.node(n))))return new ge(this,e,n);return null}sameParent(e){return this.pos-this.parentOffset==e.pos-e.parentOffset}max(e){return e.pos>this.pos?e:this}min(e){return e.pos<this.pos?e:this}toString(){let e="";for(let t=1;t<=this.depth;t++)e+=(e?"/":"")+this.node(t).type.name+"_"+this.index(t-1);return e+":"+this.parentOffset}static resolve(e,t){if(!(t>=0&&t<=e.content.size))throw new RangeError("Position "+t+" out of range");let n=[],r=0,s=t;for(let l=e;;){let{index:o,offset:h}=l.content.findIndex(s),a=s-h;if(n.push(l,o,r+h),!a||(l=l.child(o),l.isText))break;s=a-1,r+=h+1}return new i(t,n,s)}static resolveCached(e,t){let n=Je.get(e);if(n)for(let s=0;s<n.elts.length;s++){let l=n.elts[s];if(l.pos==t)return l}else Je.set(e,n=new me);let r=n.elts[n.i]=i.resolve(e,t);return n.i=(n.i+1)%Bt,r}},me=class{constructor(){this.elts=[],this.i=0}},Bt=12,Je=new WeakMap,ge=class{constructor(e,t,n){this.$from=e,this.$to=t,this.depth=n}get start(){return this.$from.before(this.depth+1)}get end(){return this.$to.after(this.depth+1)}get parent(){return this.$from.node(this.depth)}get startIndex(){return this.$from.index(this.depth)}get endIndex(){return this.$to.indexAfter(this.depth)}},Wt=Object.create(null),b=class i{constructor(e,t,n,r=w.none){this.type=e,this.attrs=t,this.marks=r,this.content=n||p.empty}get children(){return this.content.content}get nodeSize(){return this.isLeaf?1:2+this.content.size}get childCount(){return this.content.childCount}child(e){return this.content.child(e)}maybeChild(e){return this.content.maybeChild(e)}forEach(e){this.content.forEach(e)}nodesBetween(e,t,n,r=0){this.content.nodesBetween(e,t,n,r,this)}descendants(e){this.nodesBetween(0,this.content.size,e)}get textContent(){return this.isLeaf&&this.type.spec.leafText?this.type.spec.leafText(this):this.textBetween(0,this.content.size,"")}textBetween(e,t,n,r){return this.content.textBetween(e,t,n,r)}get firstChild(){return this.content.firstChild}get lastChild(){return this.content.lastChild}eq(e){return this==e||this.sameMarkup(e)&&this.content.eq(e.content)}sameMarkup(e){return this.hasMarkup(e.type,e.attrs,e.marks)}hasMarkup(e,t,n){return this.type==e&&ee(this.attrs,t||e.defaultAttrs||Wt)&&w.sameSet(this.marks,n||w.none)}copy(e=null){return e==this.content?this:new i(this.type,this.attrs,e,this.marks)}mark(e){return e==this.marks?this:new i(this.type,this.attrs,this.content,e)}cut(e,t=this.content.size){return e==0&&t==this.content.size?this:this.copy(this.content.cut(e,t))}slice(e,t=this.content.size,n=!1){if(e==t)return g.empty;let r=this.resolve(e),s=this.resolve(t),l=n?0:r.sharedDepth(t),o=r.start(l),a=r.node(l).content.cut(r.pos-o,s.pos-o);return new g(a,r.depth-l,s.depth-l)}replace(e,t,n){return Jt(this.resolve(e),this.resolve(t),n)}nodeAt(e){for(let t=this;;){let{index:n,offset:r}=t.content.findIndex(e);if(t=t.maybeChild(n),!t)return null;if(r==e||t.isText)return t;e-=r+1}}childAfter(e){let{index:t,offset:n}=this.content.findIndex(e);return{node:this.content.maybeChild(t),index:t,offset:n}}childBefore(e){if(e==0)return{node:null,index:0,offset:0};let{index:t,offset:n}=this.content.findIndex(e);if(n<e)return{node:this.content.child(t),index:t,offset:n};let r=this.content.child(t-1);return{node:r,index:t-1,offset:n-r.nodeSize}}resolve(e){return ne.resolveCached(this,e)}resolveNoCache(e){return ne.resolve(this,e)}rangeHasMark(e,t,n){let r=!1;return t>e&&this.nodesBetween(e,t,s=>(n.isInSet(s.marks)&&(r=!0),!r)),r}get isBlock(){return this.type.isBlock}get isTextblock(){return this.type.isTextblock}get inlineContent(){return this.type.inlineContent}get isInline(){return this.type.isInline}get isText(){return this.type.isText}get isLeaf(){return this.type.isLeaf}get isAtom(){return this.type.isAtom}toString(){if(this.type.spec.toDebugString)return this.type.spec.toDebugString(this);let e=this.type.name;return this.content.size&&(e+="("+this.content.toStringInner()+")"),et(this.marks,e)}contentMatchAt(e){let t=this.type.contentMatch.matchFragment(this.content,0,e);if(!t)throw new Error("Called contentMatchAt on a node with invalid content");return t}canReplace(e,t,n=p.empty,r=0,s=n.childCount){let l=this.contentMatchAt(e).matchFragment(n,r,s),o=l&&l.matchFragment(this.content,t);if(!o||!o.validEnd)return!1;for(let h=r;h<s;h++)if(!this.type.allowsMarks(n.child(h).marks))return!1;return!0}canReplaceWith(e,t,n,r){if(r&&!this.type.allowsMarks(r))return!1;let s=this.contentMatchAt(e).matchType(n),l=s&&s.matchFragment(this.content,t);return l?l.validEnd:!1}canAppend(e){return e.content.size?this.canReplace(this.childCount,this.childCount,e.content):this.type.compatibleContent(e.type)}check(){this.type.checkContent(this.content),this.type.checkAttrs(this.attrs);let e=w.none;for(let t=0;t<this.marks.length;t++){let n=this.marks[t];n.type.checkAttrs(n.attrs),e=n.addToSet(e)}if(!w.sameSet(e,this.marks))throw new RangeError(`Invalid collection of marks for node ${this.type.name}: ${this.marks.map(t=>t.type.name)}`);this.content.forEach(t=>t.check())}toJSON(){let e={type:this.type.name};for(let t in this.attrs){e.attrs=this.attrs;break}return this.content.size&&(e.content=this.content.toJSON()),this.marks.length&&(e.marks=this.marks.map(t=>t.toJSON())),e}static fromJSON(e,t){if(!t)throw new RangeError("Invalid input for Node.fromJSON");let n;if(t.marks){if(!Array.isArray(t.marks))throw new RangeError("Invalid mark data for Node.fromJSON");n=t.marks.map(e.markFromJSON)}if(t.type=="text"){if(typeof t.text!="string")throw new RangeError("Invalid text node in JSON");return e.text(t.text,n)}let r=p.fromJSON(e,t.content),s=e.nodeType(t.type).create(t.attrs,r,n);return s.type.checkAttrs(s.attrs),s}};b.prototype.text=void 0;var ye=class i extends b{constructor(e,t,n,r){if(super(e,t,null,r),!n)throw new RangeError("Empty text nodes are not allowed");this.text=n}toString(){return this.type.spec.toDebugString?this.type.spec.toDebugString(this):et(this.marks,JSON.stringify(this.text))}get textContent(){return this.text}textBetween(e,t){return this.text.slice(e,t)}get nodeSize(){return this.text.length}mark(e){return e==this.marks?this:new i(this.type,this.attrs,this.text,e)}withText(e){return e==this.text?this:new i(this.type,this.attrs,e,this.marks)}cut(e=0,t=this.text.length){return e==0&&t==this.text.length?this:this.withText(this.text.slice(e,t))}eq(e){return this.sameMarkup(e)&&this.text==e.text}toJSON(){let e=super.toJSON();return e.text=this.text,e}};function et(i,e){for(let t=i.length-1;t>=0;t--)e=i[t].type.name+"("+e+")";return e}var z=class i{constructor(e){this.validEnd=e,this.next=[],this.wrapCache=[]}static parse(e,t){let n=new we(e,t);if(n.next==null)return i.empty;let r=tt(n);n.next&&n.err("Unexpected trailing text");let s=Ht(Gt(r));return Kt(s,n),s}matchType(e){for(let t=0;t<this.next.length;t++)if(this.next[t].type==e)return this.next[t].next;return null}matchFragment(e,t=0,n=e.childCount){let r=this;for(let s=t;r&&s<n;s++)r=r.matchType(e.child(s).type);return r}get inlineContent(){return this.next.length!=0&&this.next[0].type.isInline}get defaultType(){for(let e=0;e<this.next.length;e++){let{type:t}=this.next[e];if(!(t.isText||t.hasRequiredAttrs()))return t}return null}compatible(e){for(let t=0;t<this.next.length;t++)for(let n=0;n<e.next.length;n++)if(this.next[t].type==e.next[n].type)return!0;return!1}fillBefore(e,t=!1,n=0){let r=[this];function s(l,o){let h=l.matchFragment(e,n);if(h&&(!t||h.validEnd))return p.from(o.map(a=>a.createAndFill()));for(let a=0;a<l.next.length;a++){let{type:c,next:f}=l.next[a];if(!(c.isText||c.hasRequiredAttrs())&&r.indexOf(f)==-1){r.push(f);let u=s(f,o.concat(c));if(u)return u}}return null}return s(this,[])}findWrapping(e){for(let n=0;n<this.wrapCache.length;n+=2)if(this.wrapCache[n]==e)return this.wrapCache[n+1];let t=this.computeWrapping(e);return this.wrapCache.push(e,t),t}computeWrapping(e){let t=Object.create(null),n=[{match:this,type:null,via:null}];for(;n.length;){let r=n.shift(),s=r.match;if(s.matchType(e)){let l=[];for(let o=r;o.type;o=o.via)l.push(o.type);return l.reverse()}for(let l=0;l<s.next.length;l++){let{type:o,next:h}=s.next[l];!o.isLeaf&&!o.hasRequiredAttrs()&&!(o.name in t)&&(!r.type||h.validEnd)&&(n.push({match:o.contentMatch,type:o,via:r}),t[o.name]=!0)}}return null}get edgeCount(){return this.next.length}edge(e){if(e>=this.next.length)throw new RangeError(`There's no ${e}th edge in this content match`);return this.next[e]}toString(){let e=[];function t(n){e.push(n);for(let r=0;r<n.next.length;r++)e.indexOf(n.next[r].next)==-1&&t(n.next[r].next)}return t(this),e.map((n,r)=>{let s=r+(n.validEnd?"*":" ")+" ";for(let l=0;l<n.next.length;l++)s+=(l?", ":"")+n.next[l].type.name+"->"+e.indexOf(n.next[l].next);return s}).join(`
`)}};z.empty=new z(!0);var we=class{constructor(e,t){this.string=e,this.nodeTypes=t,this.inline=null,this.pos=0,this.tokens=e.split(/\s*(?=\b|\W|$)/),this.tokens[this.tokens.length-1]==""&&this.tokens.pop(),this.tokens[0]==""&&this.tokens.shift()}get next(){return this.tokens[this.pos]}eat(e){return this.next==e&&(this.pos++||!0)}err(e){throw new SyntaxError(e+" (in content expression '"+this.string+"')")}};function tt(i){let e=[];do e.push(Pt(i));while(i.eat("|"));return e.length==1?e[0]:{type:"choice",exprs:e}}function Pt(i){let e=[];do e.push(Lt(i));while(i.next&&i.next!=")"&&i.next!="|");return e.length==1?e[0]:{type:"seq",exprs:e}}function Lt(i){let e=Vt(i);for(;;)if(i.eat("+"))e={type:"plus",expr:e};else if(i.eat("*"))e={type:"star",expr:e};else if(i.eat("?"))e={type:"opt",expr:e};else if(i.eat("{"))e=qt(i,e);else break;return e}function De(i){/\D/.test(i.next)&&i.err("Expected number, got '"+i.next+"'");let e=Number(i.next);return i.pos++,e}function qt(i,e){let t=De(i),n=t;return i.eat(",")&&(i.next!="}"?n=De(i):n=-1),i.eat("}")||i.err("Unclosed braced range"),{type:"range",min:t,max:n,expr:e}}function Ut(i,e){let t=i.nodeTypes,n=t[e];if(n)return[n];let r=[];for(let s in t){let l=t[s];l.isInGroup(e)&&r.push(l)}return r.length==0&&i.err("No node type or group '"+e+"' found"),r}function Vt(i){if(i.eat("(")){let e=tt(i);return i.eat(")")||i.err("Missing closing paren"),e}else if(/\W/.test(i.next))i.err("Unexpected token '"+i.next+"'");else{let e=Ut(i,i.next).map(t=>(i.inline==null?i.inline=t.isInline:i.inline!=t.isInline&&i.err("Mixing inline and block content"),{type:"name",value:t}));return i.pos++,e.length==1?e[0]:{type:"choice",exprs:e}}}function Gt(i){let e=[[]];return r(s(i,0),t()),e;function t(){return e.push([])-1}function n(l,o,h){let a={term:h,to:o};return e[l].push(a),a}function r(l,o){l.forEach(h=>h.to=o)}function s(l,o){if(l.type=="choice")return l.exprs.reduce((h,a)=>h.concat(s(a,o)),[]);if(l.type=="seq")for(let h=0;;h++){let a=s(l.exprs[h],o);if(h==l.exprs.length-1)return a;r(a,o=t())}else if(l.type=="star"){let h=t();return n(o,h),r(s(l.expr,h),h),[n(h)]}else if(l.type=="plus"){let h=t();return r(s(l.expr,o),h),r(s(l.expr,h),h),[n(h)]}else{if(l.type=="opt")return[n(o)].concat(s(l.expr,o));if(l.type=="range"){let h=o;for(let a=0;a<l.min;a++){let c=t();r(s(l.expr,h),c),h=c}if(l.max==-1)r(s(l.expr,h),h);else for(let a=l.min;a<l.max;a++){let c=t();n(h,c),r(s(l.expr,h),c),h=c}return[n(h)]}else{if(l.type=="name")return[n(o,void 0,l.value)];throw new Error("Unknown expr type")}}}}function nt(i,e){return e-i}function Be(i,e){let t=[];return n(e),t.sort(nt);function n(r){let s=i[r];if(s.length==1&&!s[0].term)return n(s[0].to);t.push(r);for(let l=0;l<s.length;l++){let{term:o,to:h}=s[l];!o&&t.indexOf(h)==-1&&n(h)}}}function Ht(i){let e=Object.create(null);return t(Be(i,0));function t(n){let r=[];n.forEach(l=>{i[l].forEach(({term:o,to:h})=>{if(!o)return;let a;for(let c=0;c<r.length;c++)r[c][0]==o&&(a=r[c][1]);Be(i,h).forEach(c=>{a||r.push([o,a=[]]),a.indexOf(c)==-1&&a.push(c)})})});let s=e[n.join(",")]=new z(n.indexOf(i.length-1)>-1);for(let l=0;l<r.length;l++){let o=r[l][1].sort(nt);s.next.push({type:r[l][0],next:e[o.join(",")]||t(o)})}return s}}function Kt(i,e){for(let t=0,n=[i];t<n.length;t++){let r=n[t],s=!r.validEnd,l=[];for(let o=0;o<r.next.length;o++){let{type:h,next:a}=r.next[o];l.push(h.name),s&&!(h.isText||h.hasRequiredAttrs())&&(s=!1),n.indexOf(a)==-1&&n.push(a)}s&&e.err("Only non-generatable nodes ("+l.join(", ")+") in a required position (see https://prosemirror.net/docs/guide/#generatable)")}}function rt(i){let e=Object.create(null);for(let t in i){let n=i[t];if(!n.hasDefault)return null;e[t]=n.default}return e}function it(i,e){let t=Object.create(null);for(let n in i){let r=e&&e[n];if(r===void 0){let s=i[n];if(s.hasDefault)r=s.default;else throw new RangeError("No value supplied for attribute "+n)}t[n]=r}return t}function st(i,e,t,n){for(let r in e)if(!(r in i))throw new RangeError(`Unsupported attribute ${r} for ${t} of type ${r}`);for(let r in i){let s=i[r];s.validate&&s.validate(e[r])}}function lt(i,e){let t=Object.create(null);if(e)for(let n in e)t[n]=new xe(i,n,e[n]);return t}var re=class i{constructor(e,t,n){this.name=e,this.schema=t,this.spec=n,this.markSet=null,this.groups=n.group?n.group.split(" "):[],this.attrs=lt(e,n.attrs),this.defaultAttrs=rt(this.attrs),this.contentMatch=null,this.inlineContent=null,this.isBlock=!(n.inline||e=="text"),this.isText=e=="text"}get isInline(){return!this.isBlock}get isTextblock(){return this.isBlock&&this.inlineContent}get isLeaf(){return this.contentMatch==z.empty}get isAtom(){return this.isLeaf||!!this.spec.atom}isInGroup(e){return this.groups.indexOf(e)>-1}get whitespace(){return this.spec.whitespace||(this.spec.code?"pre":"normal")}hasRequiredAttrs(){for(let e in this.attrs)if(this.attrs[e].isRequired)return!0;return!1}compatibleContent(e){return this==e||this.contentMatch.compatible(e.contentMatch)}computeAttrs(e){return!e&&this.defaultAttrs?this.defaultAttrs:it(this.attrs,e)}create(e=null,t,n){if(this.isText)throw new Error("NodeType.create can't construct text nodes");return new b(this,this.computeAttrs(e),p.from(t),w.setFrom(n))}createChecked(e=null,t,n){return t=p.from(t),this.checkContent(t),new b(this,this.computeAttrs(e),t,w.setFrom(n))}createAndFill(e=null,t,n){if(e=this.computeAttrs(e),t=p.from(t),t.size){let l=this.contentMatch.fillBefore(t);if(!l)return null;t=l.append(t)}let r=this.contentMatch.matchFragment(t),s=r&&r.fillBefore(p.empty,!0);return s?new b(this,e,t.append(s),w.setFrom(n)):null}validContent(e){let t=this.contentMatch.matchFragment(e);if(!t||!t.validEnd)return!1;for(let n=0;n<e.childCount;n++)if(!this.allowsMarks(e.child(n).marks))return!1;return!0}checkContent(e){if(!this.validContent(e))throw new RangeError(`Invalid content for node ${this.name}: ${e.toString().slice(0,50)}`)}checkAttrs(e){st(this.attrs,e,"node",this.name)}allowsMarkType(e){return this.markSet==null||this.markSet.indexOf(e)>-1}allowsMarks(e){if(this.markSet==null)return!0;for(let t=0;t<e.length;t++)if(!this.allowsMarkType(e[t].type))return!1;return!0}allowedMarks(e){if(this.markSet==null)return e;let t;for(let n=0;n<e.length;n++)this.allowsMarkType(e[n].type)?t&&t.push(e[n]):t||(t=e.slice(0,n));return t?t.length?t:w.none:e}static compile(e,t){let n=Object.create(null);e.forEach((s,l)=>n[s]=new i(s,t,l));let r=t.spec.topNode||"doc";if(!n[r])throw new RangeError("Schema is missing its top node type ('"+r+"')");if(!n.text)throw new RangeError("Every schema needs a 'text' type");for(let s in n.text.attrs)throw new RangeError("The text node type should not have attributes");return n}};function Qt(i,e,t){let n=t.split("|");return r=>{let s=r===null?"null":typeof r;if(n.indexOf(s)<0)throw new RangeError(`Expected value of type ${n} for attribute ${e} on type ${i}, got ${s}`)}}var xe=class{constructor(e,t,n){this.hasDefault=Object.prototype.hasOwnProperty.call(n,"default"),this.default=n.default,this.validate=typeof n.validate=="string"?Qt(e,t,n.validate):n.validate}get isRequired(){return!this.hasDefault}},V=class i{constructor(e,t,n,r){this.name=e,this.rank=t,this.schema=n,this.spec=r,this.attrs=lt(e,r.attrs),this.excluded=null;let s=rt(this.attrs);this.instance=s?new w(this,s):null}create(e=null){return!e&&this.instance?this.instance:new w(this,it(this.attrs,e))}static compile(e,t){let n=Object.create(null),r=0;return e.forEach((s,l)=>n[s]=new i(s,r++,t,l)),n}removeFromSet(e){for(var t=0;t<e.length;t++)e[t].type==this&&(e=e.slice(0,t).concat(e.slice(t+1)),t--);return e}isInSet(e){for(let t=0;t<e.length;t++)if(e[t].type==this)return e[t]}checkAttrs(e){st(this.attrs,e,"mark",this.name)}excludes(e){return this.excluded.indexOf(e)>-1}},We=class{constructor(e){this.linebreakReplacement=null,this.cached=Object.create(null);let t=this.spec={};for(let r in e)t[r]=e[r];t.nodes=fe.from(e.nodes),t.marks=fe.from(e.marks||{}),this.nodes=re.compile(this.spec.nodes,this),this.marks=V.compile(this.spec.marks,this);let n=Object.create(null);for(let r in this.nodes){if(r in this.marks)throw new RangeError(r+" can not be both a node and a mark");let s=this.nodes[r],l=s.spec.content||"",o=s.spec.marks;if(s.contentMatch=n[l]||(n[l]=z.parse(l,this.nodes)),s.inlineContent=s.contentMatch.inlineContent,s.spec.linebreakReplacement){if(this.linebreakReplacement)throw new RangeError("Multiple linebreak nodes defined");if(!s.isInline||!s.isLeaf)throw new RangeError("Linebreak replacement nodes must be inline leaf nodes");this.linebreakReplacement=s}s.markSet=o=="_"?null:o?Pe(this,o.split(" ")):o==""||!s.inlineContent?[]:null}for(let r in this.marks){let s=this.marks[r],l=s.spec.excludes;s.excluded=l==null?[s]:l==""?[]:Pe(this,l.split(" "))}this.nodeFromJSON=r=>b.fromJSON(this,r),this.markFromJSON=r=>w.fromJSON(this,r),this.topNodeType=this.nodes[this.spec.topNode||"doc"],this.cached.wrappings=Object.create(null)}node(e,t=null,n,r){if(typeof e=="string")e=this.nodeType(e);else if(e instanceof re){if(e.schema!=this)throw new RangeError("Node type from different schema used ("+e.name+")")}else throw new RangeError("Invalid node type: "+e);return e.createChecked(t,n,r)}text(e,t){let n=this.nodes.text;return new ye(n,n.defaultAttrs,e,w.setFrom(t))}mark(e,t){return typeof e=="string"&&(e=this.marks[e]),e.create(t)}nodeType(e){let t=this.nodes[e];if(!t)throw new RangeError("Unknown node type: "+e);return t}};function Pe(i,e){let t=[];for(let n=0;n<e.length;n++){let r=e[n],s=i.marks[r],l=s;if(s)t.push(s);else for(let o in i.marks){let h=i.marks[o];(r=="_"||h.spec.group&&h.spec.group.split(" ").indexOf(r)>-1)&&t.push(l=h)}if(!l)throw new SyntaxError("Unknown mark type: '"+e[n]+"'")}return t}function Xt(i){return i.tag!=null}function Yt(i){return i.style!=null}var Le=class i{constructor(e,t){this.schema=e,this.rules=t,this.tags=[],this.styles=[];let n=this.matchedStyles=[];t.forEach(r=>{if(Xt(r))this.tags.push(r);else if(Yt(r)){let s=/[^=]*/.exec(r.style)[0];n.indexOf(s)<0&&n.push(s),this.styles.push(r)}}),this.normalizeLists=!this.tags.some(r=>{if(!/^(ul|ol)\b/.test(r.tag)||!r.node)return!1;let s=e.nodes[r.node];return s.contentMatch.matchType(s)})}parse(e,t={}){let n=new ie(this,t,!1);return n.addAll(e,w.none,t.from,t.to),n.finish()}parseSlice(e,t={}){let n=new ie(this,t,!0);return n.addAll(e,w.none,t.from,t.to),g.maxOpen(n.finish())}matchTag(e,t,n){for(let r=n?this.tags.indexOf(n)+1:0;r<this.tags.length;r++){let s=this.tags[r];if($t(e,s.tag)&&(s.namespace===void 0||e.namespaceURI==s.namespace)&&(!s.context||t.matchesContext(s.context))){if(s.getAttrs){let l=s.getAttrs(e);if(l===!1)continue;s.attrs=l||void 0}return s}}}matchStyle(e,t,n,r){for(let s=r?this.styles.indexOf(r)+1:0;s<this.styles.length;s++){let l=this.styles[s],o=l.style;if(!(o.indexOf(e)!=0||l.context&&!n.matchesContext(l.context)||o.length>e.length&&(o.charCodeAt(e.length)!=61||o.slice(e.length+1)!=t))){if(l.getAttrs){let h=l.getAttrs(t);if(h===!1)continue;l.attrs=h||void 0}return l}}}static schemaRules(e){let t=[];function n(r){let s=r.priority==null?50:r.priority,l=0;for(;l<t.length;l++){let o=t[l];if((o.priority==null?50:o.priority)<s)break}t.splice(l,0,r)}for(let r in e.marks){let s=e.marks[r].spec.parseDOM;s&&s.forEach(l=>{n(l=Ue(l)),l.mark||l.ignore||l.clearMark||(l.mark=r)})}for(let r in e.nodes){let s=e.nodes[r].spec.parseDOM;s&&s.forEach(l=>{n(l=Ue(l)),l.node||l.ignore||l.mark||(l.node=r)})}return t}static fromSchema(e){return e.cached.domParser||(e.cached.domParser=new i(e,i.schemaRules(e)))}},ot={address:!0,article:!0,aside:!0,blockquote:!0,canvas:!0,dd:!0,div:!0,dl:!0,fieldset:!0,figcaption:!0,figure:!0,footer:!0,form:!0,h1:!0,h2:!0,h3:!0,h4:!0,h5:!0,h6:!0,header:!0,hgroup:!0,hr:!0,li:!0,noscript:!0,ol:!0,output:!0,p:!0,pre:!0,section:!0,table:!0,tfoot:!0,ul:!0},Zt={head:!0,noscript:!0,object:!0,script:!0,style:!0,title:!0},ht={ol:!0,ul:!0},G=1,ke=2,U=4;function qe(i,e,t){return e!=null?(e?G:0)|(e==="full"?ke:0):i&&i.whitespace=="pre"?G|ke:t&~U}var W=class{constructor(e,t,n,r,s,l){this.type=e,this.attrs=t,this.marks=n,this.solid=r,this.options=l,this.content=[],this.activeMarks=w.none,this.match=s||(l&U?null:e.contentMatch)}findWrapping(e){if(!this.match){if(!this.type)return[];let t=this.type.contentMatch.fillBefore(p.from(e));if(t)this.match=this.type.contentMatch.matchFragment(t);else{let n=this.type.contentMatch,r;return(r=n.findWrapping(e.type))?(this.match=n,r):null}}return this.match.findWrapping(e.type)}finish(e){if(!(this.options&G)){let n=this.content[this.content.length-1],r;if(n&&n.isText&&(r=/[ \t\r\n\u000c]+$/.exec(n.text))){let s=n;n.text.length==r[0].length?this.content.pop():this.content[this.content.length-1]=s.withText(s.text.slice(0,s.text.length-r[0].length))}}let t=p.from(this.content);return!e&&this.match&&(t=t.append(this.match.fillBefore(p.empty,!0))),this.type?this.type.create(this.attrs,t,this.marks):t}inlineContext(e){return this.type?this.type.inlineContent:this.content.length?this.content[0].isInline:e.parentNode&&!ot.hasOwnProperty(e.parentNode.nodeName.toLowerCase())}},ie=class{constructor(e,t,n){this.parser=e,this.options=t,this.isOpen=n,this.open=0,this.localPreserveWS=!1;let r=t.topNode,s,l=qe(null,t.preserveWhitespace,0)|(n?U:0);r?s=new W(r.type,r.attrs,w.none,!0,t.topMatch||r.type.contentMatch,l):n?s=new W(null,null,w.none,!0,null,l):s=new W(e.schema.topNodeType,null,w.none,!0,null,l),this.nodes=[s],this.find=t.findPositions,this.needsBlock=!1}get top(){return this.nodes[this.open]}addDOM(e,t){e.nodeType==3?this.addTextNode(e,t):e.nodeType==1&&this.addElement(e,t)}addTextNode(e,t){let n=e.nodeValue,r=this.top,s=r.options&ke?"full":this.localPreserveWS||(r.options&G)>0;if(s==="full"||r.inlineContext(e)||/[^ \t\r\n\u000c]/.test(n)){if(s)s!=="full"?n=n.replace(/\r?\n|\r/g," "):n=n.replace(/\r\n?/g,`
`);else if(n=n.replace(/[ \t\r\n\u000c]+/g," "),/^[ \t\r\n\u000c]/.test(n)&&this.open==this.nodes.length-1){let l=r.content[r.content.length-1],o=e.previousSibling;(!l||o&&o.nodeName=="BR"||l.isText&&/[ \t\r\n\u000c]$/.test(l.text))&&(n=n.slice(1))}n&&this.insertNode(this.parser.schema.text(n),t,!/\S/.test(n)),this.findInText(e)}else this.findInside(e)}addElement(e,t,n){let r=this.localPreserveWS,s=this.top;(e.tagName=="PRE"||/pre/.test(e.style&&e.style.whiteSpace))&&(this.localPreserveWS=!0);let l=e.nodeName.toLowerCase(),o;ht.hasOwnProperty(l)&&this.parser.normalizeLists&&jt(e);let h=this.options.ruleFromNode&&this.options.ruleFromNode(e)||(o=this.parser.matchTag(e,this,n));e:if(h?h.ignore:Zt.hasOwnProperty(l))this.findInside(e),this.ignoreFallback(e,t);else if(!h||h.skip||h.closeParent){h&&h.closeParent?this.open=Math.max(0,this.open-1):h&&h.skip.nodeType&&(e=h.skip);let a,c=this.needsBlock;if(ot.hasOwnProperty(l))s.content.length&&s.content[0].isInline&&this.open&&(this.open--,s=this.top),a=!0,s.type||(this.needsBlock=!0);else if(!e.firstChild){this.leafFallback(e,t);break e}let f=h&&h.skip?t:this.readStyles(e,t);f&&this.addAll(e,f),a&&this.sync(s),this.needsBlock=c}else{let a=this.readStyles(e,t);a&&this.addElementByRule(e,h,a,h.consuming===!1?o:void 0)}this.localPreserveWS=r}leafFallback(e,t){e.nodeName=="BR"&&this.top.type&&this.top.type.inlineContent&&this.addTextNode(e.ownerDocument.createTextNode(`
`),t)}ignoreFallback(e,t){e.nodeName=="BR"&&(!this.top.type||!this.top.type.inlineContent)&&this.findPlace(this.parser.schema.text("-"),t,!0)}readStyles(e,t){let n=e.style;if(n&&n.length)for(let r=0;r<this.parser.matchedStyles.length;r++){let s=this.parser.matchedStyles[r],l=n.getPropertyValue(s);if(l)for(let o=void 0;;){let h=this.parser.matchStyle(s,l,this,o);if(!h)break;if(h.ignore)return null;if(h.clearMark?t=t.filter(a=>!h.clearMark(a)):t=t.concat(this.parser.schema.marks[h.mark].create(h.attrs)),h.consuming===!1)o=h;else break}}return t}addElementByRule(e,t,n,r){let s,l;if(t.node)if(l=this.parser.schema.nodes[t.node],l.isLeaf)this.insertNode(l.create(t.attrs),n,e.nodeName=="BR")||this.leafFallback(e,n);else{let h=this.enter(l,t.attrs||null,n,t.preserveWhitespace);h&&(s=!0,n=h)}else{let h=this.parser.schema.marks[t.mark];n=n.concat(h.create(t.attrs))}let o=this.top;if(l&&l.isLeaf)this.findInside(e);else if(r)this.addElement(e,n,r);else if(t.getContent)this.findInside(e),t.getContent(e,this.parser.schema).forEach(h=>this.insertNode(h,n,!1));else{let h=e;typeof t.contentElement=="string"?h=e.querySelector(t.contentElement):typeof t.contentElement=="function"?h=t.contentElement(e):t.contentElement&&(h=t.contentElement),this.findAround(e,h,!0),this.addAll(h,n),this.findAround(e,h,!1)}s&&this.sync(o)&&this.open--}addAll(e,t,n,r){let s=n||0;for(let l=n?e.childNodes[n]:e.firstChild,o=r==null?null:e.childNodes[r];l!=o;l=l.nextSibling,++s)this.findAtPoint(e,s),this.addDOM(l,t);this.findAtPoint(e,s)}findPlace(e,t,n){let r,s;for(let l=this.open,o=0;l>=0;l--){let h=this.nodes[l],a=h.findWrapping(e);if(a&&(!r||r.length>a.length+o)&&(r=a,s=h,!a.length))break;if(h.solid){if(n)break;o+=2}}if(!r)return null;this.sync(s);for(let l=0;l<r.length;l++)t=this.enterInner(r[l],null,t,!1);return t}insertNode(e,t,n){if(e.isInline&&this.needsBlock&&!this.top.type){let s=this.textblockFromContext();s&&(t=this.enterInner(s,null,t))}let r=this.findPlace(e,t,n);if(r){this.closeExtra();let s=this.top;s.match&&(s.match=s.match.matchType(e.type));let l=w.none;for(let o of r.concat(e.marks))(s.type?s.type.allowsMarkType(o.type):Ve(o.type,e.type))&&(l=o.addToSet(l));return s.content.push(e.mark(l)),!0}return!1}enter(e,t,n,r){let s=this.findPlace(e.create(t),n,!1);return s&&(s=this.enterInner(e,t,n,!0,r)),s}enterInner(e,t,n,r=!1,s){this.closeExtra();let l=this.top;l.match=l.match&&l.match.matchType(e);let o=qe(e,s,l.options);l.options&U&&l.content.length==0&&(o|=U);let h=w.none;return n=n.filter(a=>(l.type?l.type.allowsMarkType(a.type):Ve(a.type,e))?(h=a.addToSet(h),!1):!0),this.nodes.push(new W(e,t,h,r,null,o)),this.open++,n}closeExtra(e=!1){let t=this.nodes.length-1;if(t>this.open){for(;t>this.open;t--)this.nodes[t-1].content.push(this.nodes[t].finish(e));this.nodes.length=this.open+1}}finish(){return this.open=0,this.closeExtra(this.isOpen),this.nodes[0].finish(!!(this.isOpen||this.options.topOpen))}sync(e){for(let t=this.open;t>=0;t--){if(this.nodes[t]==e)return this.open=t,!0;this.localPreserveWS&&(this.nodes[t].options|=G)}return!1}get currentPos(){this.closeExtra();let e=0;for(let t=this.open;t>=0;t--){let n=this.nodes[t].content;for(let r=n.length-1;r>=0;r--)e+=n[r].nodeSize;t&&e++}return e}findAtPoint(e,t){if(this.find)for(let n=0;n<this.find.length;n++)this.find[n].node==e&&this.find[n].offset==t&&(this.find[n].pos=this.currentPos)}findInside(e){if(this.find)for(let t=0;t<this.find.length;t++)this.find[t].pos==null&&e.nodeType==1&&e.contains(this.find[t].node)&&(this.find[t].pos=this.currentPos)}findAround(e,t,n){if(e!=t&&this.find)for(let r=0;r<this.find.length;r++)this.find[r].pos==null&&e.nodeType==1&&e.contains(this.find[r].node)&&t.compareDocumentPosition(this.find[r].node)&(n?2:4)&&(this.find[r].pos=this.currentPos)}findInText(e){if(this.find)for(let t=0;t<this.find.length;t++)this.find[t].node==e&&(this.find[t].pos=this.currentPos-(e.nodeValue.length-this.find[t].offset))}matchesContext(e){if(e.indexOf("|")>-1)return e.split(/\s*\|\s*/).some(this.matchesContext,this);let t=e.split("/"),n=this.options.context,r=!this.isOpen&&(!n||n.parent.type==this.nodes[0].type),s=-(n?n.depth+1:0)+(r?0:1),l=(o,h)=>{for(;o>=0;o--){let a=t[o];if(a==""){if(o==t.length-1||o==0)continue;for(;h>=s;h--)if(l(o-1,h))return!0;return!1}else{let c=h>0||h==0&&r?this.nodes[h].type:n&&h>=s?n.node(h-s).type:null;if(!c||c.name!=a&&!c.isInGroup(a))return!1;h--}}return!0};return l(t.length-1,this.open)}textblockFromContext(){let e=this.options.context;if(e)for(let t=e.depth;t>=0;t--){let n=e.node(t).contentMatchAt(e.indexAfter(t)).defaultType;if(n&&n.isTextblock&&n.defaultAttrs)return n}for(let t in this.parser.schema.nodes){let n=this.parser.schema.nodes[t];if(n.isTextblock&&n.defaultAttrs)return n}}};function jt(i){for(let e=i.firstChild,t=null;e;e=e.nextSibling){let n=e.nodeType==1?e.nodeName.toLowerCase():null;n&&ht.hasOwnProperty(n)&&t?(t.appendChild(e),e=t):n=="li"?t=e:n&&(t=null)}}function $t(i,e){return(i.matches||i.msMatchesSelector||i.webkitMatchesSelector||i.mozMatchesSelector).call(i,e)}function Ue(i){let e={};for(let t in i)e[t]=i[t];return e}function Ve(i,e){let t=e.schema.nodes;for(let n in t){let r=t[n];if(!r.allowsMarkType(i))continue;let s=[],l=o=>{s.push(o);for(let h=0;h<o.edgeCount;h++){let{type:a,next:c}=o.edge(h);if(a==e||s.indexOf(c)<0&&l(c))return!0}};if(l(r.contentMatch))return!0}}var Ge=class i{constructor(e,t){this.nodes=e,this.marks=t}serializeFragment(e,t={},n){n||(n=pe(t).createDocumentFragment());let r=n,s=[];return e.forEach(l=>{if(s.length||l.marks.length){let o=0,h=0;for(;o<s.length&&h<l.marks.length;){let a=l.marks[h];if(!this.marks[a.type.name]){h++;continue}if(!a.eq(s[o][0])||a.type.spec.spanning===!1)break;o++,h++}for(;o<s.length;)r=s.pop()[1];for(;h<l.marks.length;){let a=l.marks[h++],c=this.serializeMark(a,l.isInline,t);c&&(s.push([a,r]),r.appendChild(c.dom),r=c.contentDOM||c.dom)}}r.appendChild(this.serializeNodeInner(l,t))}),n}serializeNodeInner(e,t){let{dom:n,contentDOM:r}=_(pe(t),this.nodes[e.type.name](e),null,e.attrs);if(r){if(e.isLeaf)throw new RangeError("Content hole not allowed in a leaf node spec");this.serializeFragment(e.content,t,r)}return n}serializeNode(e,t={}){let n=this.serializeNodeInner(e,t);for(let r=e.marks.length-1;r>=0;r--){let s=this.serializeMark(e.marks[r],e.isInline,t);s&&((s.contentDOM||s.dom).appendChild(n),n=s.dom)}return n}serializeMark(e,t,n={}){let r=this.marks[e.type.name];return r&&_(pe(n),r(e,t),null,e.attrs)}static renderSpec(e,t,n=null,r){return _(e,t,n,r)}static fromSchema(e){return e.cached.domSerializer||(e.cached.domSerializer=new i(this.nodesFromSchema(e),this.marksFromSchema(e)))}static nodesFromSchema(e){let t=He(e.nodes);return t.text||(t.text=n=>n.text),t}static marksFromSchema(e){return He(e.marks)}};function He(i){let e={};for(let t in i){let n=i[t].spec.toDOM;n&&(e[t]=n)}return e}function pe(i){return i.document||window.document}var Ke=new WeakMap;function _t(i){let e=Ke.get(i);return e===void 0&&Ke.set(i,e=en(i)),e}function en(i){let e=null;function t(n){if(n&&typeof n=="object")if(Array.isArray(n))if(typeof n[0]=="string")e||(e=[]),e.push(n);else for(let r=0;r<n.length;r++)t(n[r]);else for(let r in n)t(n[r])}return t(i),e}function _(i,e,t,n){if(typeof e=="string")return{dom:i.createTextNode(e)};if(e.nodeType!=null)return{dom:e};if(e.dom&&e.dom.nodeType!=null)return e;let r=e[0],s;if(typeof r!="string")throw new RangeError("Invalid array passed to renderSpec");if(n&&(s=_t(n))&&s.indexOf(e)>-1)throw new RangeError("Using an array from an attribute object as a DOM spec. This may be an attempted cross site scripting attack.");let l=r.indexOf(" ");l>0&&(t=r.slice(0,l),r=r.slice(l+1));let o,h=t?i.createElementNS(t,r):i.createElement(r),a=e[1],c=1;if(a&&typeof a=="object"&&a.nodeType==null&&!Array.isArray(a)){c=2;for(let f in a)if(a[f]!=null){let u=f.indexOf(" ");u>0?h.setAttributeNS(f.slice(0,u),f.slice(u+1),a[f]):f=="style"&&h.style?h.style.cssText=a[f]:h.setAttribute(f,a[f])}}for(let f=c;f<e.length;f++){let u=e[f];if(u===0){if(f<e.length-1||f>c)throw new RangeError("Content hole must be the only child of its parent node");return{dom:h,contentDOM:h}}else{let{dom:d,contentDOM:m}=_(i,u,t,n);if(h.appendChild(d),m){if(o)throw new RangeError("Multiple content holes");o=m}}}return{dom:h,contentDOM:o}}var ft=65535,ut=Math.pow(2,16);function tn(i,e){return i+e*ut}function at(i){return i&ft}function nn(i){return(i-(i&ft))/ut}var pt=1,dt=2,se=4,mt=8,Q=class{constructor(e,t,n){this.pos=e,this.delInfo=t,this.recover=n}get deleted(){return(this.delInfo&mt)>0}get deletedBefore(){return(this.delInfo&(pt|se))>0}get deletedAfter(){return(this.delInfo&(dt|se))>0}get deletedAcross(){return(this.delInfo&se)>0}},C=class i{constructor(e,t=!1){if(this.ranges=e,this.inverted=t,!e.length&&i.empty)return i.empty}recover(e){let t=0,n=at(e);if(!this.inverted)for(let r=0;r<n;r++)t+=this.ranges[r*3+2]-this.ranges[r*3+1];return this.ranges[n*3]+t+nn(e)}mapResult(e,t=1){return this._map(e,t,!1)}map(e,t=1){return this._map(e,t,!0)}_map(e,t,n){let r=0,s=this.inverted?2:1,l=this.inverted?1:2;for(let o=0;o<this.ranges.length;o+=3){let h=this.ranges[o]-(this.inverted?r:0);if(h>e)break;let a=this.ranges[o+s],c=this.ranges[o+l],f=h+a;if(e<=f){let u=a?e==h?-1:e==f?1:t:t,d=h+r+(u<0?0:c);if(n)return d;let m=e==(t<0?h:f)?null:tn(o/3,e-h),y=e==h?dt:e==f?pt:se;return(t<0?e!=h:e!=f)&&(y|=mt),new Q(d,y,m)}r+=c-a}return n?e+r:new Q(e+r,0,null)}touches(e,t){let n=0,r=at(t),s=this.inverted?2:1,l=this.inverted?1:2;for(let o=0;o<this.ranges.length;o+=3){let h=this.ranges[o]-(this.inverted?n:0);if(h>e)break;let a=this.ranges[o+s],c=h+a;if(e<=c&&o==r*3)return!0;n+=this.ranges[o+l]-a}return!1}forEach(e){let t=this.inverted?2:1,n=this.inverted?1:2;for(let r=0,s=0;r<this.ranges.length;r+=3){let l=this.ranges[r],o=l-(this.inverted?s:0),h=l+(this.inverted?0:s),a=this.ranges[r+t],c=this.ranges[r+n];e(o,o+a,h,h+c),s+=c-a}}invert(){return new i(this.ranges,!this.inverted)}toString(){return(this.inverted?"-":"")+JSON.stringify(this.ranges)}static offset(e){return e==0?i.empty:new i(e<0?[0,-e,0]:[0,0,e])}};C.empty=new C([]);var Ee=class i{constructor(e=[],t,n=0,r=e.length){this.maps=e,this.mirror=t,this.from=n,this.to=r}slice(e=0,t=this.maps.length){return new i(this.maps,this.mirror,e,t)}copy(){return new i(this.maps.slice(),this.mirror&&this.mirror.slice(),this.from,this.to)}appendMap(e,t){this.to=this.maps.push(e),t!=null&&this.setMirror(this.maps.length-1,t)}appendMapping(e){for(let t=0,n=this.maps.length;t<e.maps.length;t++){let r=e.getMirror(t);this.appendMap(e.maps[t],r!=null&&r<t?n+r:void 0)}}getMirror(e){if(this.mirror){for(let t=0;t<this.mirror.length;t++)if(this.mirror[t]==e)return this.mirror[t+(t%2?-1:1)]}}setMirror(e,t){this.mirror||(this.mirror=[]),this.mirror.push(e,t)}appendMappingInverted(e){for(let t=e.maps.length-1,n=this.maps.length+e.maps.length;t>=0;t--){let r=e.getMirror(t);this.appendMap(e.maps[t].invert(),r!=null&&r>t?n-r-1:void 0)}}invert(){let e=new i;return e.appendMappingInverted(this),e}map(e,t=1){if(this.mirror)return this._map(e,t,!0);for(let n=this.from;n<this.to;n++)e=this.maps[n].map(e,t);return e}mapResult(e,t=1){return this._map(e,t,!1)}_map(e,t,n){let r=0;for(let s=this.from;s<this.to;s++){let l=this.maps[s],o=l.mapResult(e,t);if(o.recover!=null){let h=this.getMirror(s);if(h!=null&&h>s&&h<this.to){s=h,e=this.maps[h].recover(o.recover);continue}}r|=o.delInfo,e=o.pos}return n?e:new Q(e,r,null)}},Se=Object.create(null),k=class{getMap(){return C.empty}merge(e){return null}static fromJSON(e,t){if(!t||!t.stepType)throw new RangeError("Invalid input for Step.fromJSON");let n=Se[t.stepType];if(!n)throw new RangeError(`No step type ${t.stepType} defined`);return n.fromJSON(e,t)}static jsonID(e,t){if(e in Se)throw new RangeError("Duplicate use of step JSON ID "+e);return Se[e]=t,t.prototype.jsonID=e,t}},S=class i{constructor(e,t){this.doc=e,this.failed=t}static ok(e){return new i(e,null)}static fail(e){return new i(null,e)}static fromReplace(e,t,n,r){try{return i.ok(e.replace(t,n,r))}catch(s){if(s instanceof A)return i.fail(s.message);throw s}}};function Ce(i,e,t){let n=[];for(let r=0;r<i.childCount;r++){let s=i.child(r);s.content.size&&(s=s.copy(Ce(s.content,e,s))),s.isInline&&(s=e(s,t,r)),n.push(s)}return p.fromArray(n)}var X=class i extends k{constructor(e,t,n){super(),this.from=e,this.to=t,this.mark=n}apply(e){let t=e.slice(this.from,this.to),n=e.resolve(this.from),r=n.node(n.sharedDepth(this.to)),s=new g(Ce(t.content,(l,o)=>!l.isAtom||!o.type.allowsMarkType(this.mark.type)?l:l.mark(this.mark.addToSet(l.marks)),r),t.openStart,t.openEnd);return S.fromReplace(e,this.from,this.to,s)}invert(){return new F(this.from,this.to,this.mark)}map(e){let t=e.mapResult(this.from,1),n=e.mapResult(this.to,-1);return t.deleted&&n.deleted||t.pos>=n.pos?null:new i(t.pos,n.pos,this.mark)}merge(e){return e instanceof i&&e.mark.eq(this.mark)&&this.from<=e.to&&this.to>=e.from?new i(Math.min(this.from,e.from),Math.max(this.to,e.to),this.mark):null}toJSON(){return{stepType:"addMark",mark:this.mark.toJSON(),from:this.from,to:this.to}}static fromJSON(e,t){if(typeof t.from!="number"||typeof t.to!="number")throw new RangeError("Invalid input for AddMarkStep.fromJSON");return new i(t.from,t.to,e.markFromJSON(t.mark))}};k.jsonID("addMark",X);var F=class i extends k{constructor(e,t,n){super(),this.from=e,this.to=t,this.mark=n}apply(e){let t=e.slice(this.from,this.to),n=new g(Ce(t.content,r=>r.mark(this.mark.removeFromSet(r.marks)),e),t.openStart,t.openEnd);return S.fromReplace(e,this.from,this.to,n)}invert(){return new X(this.from,this.to,this.mark)}map(e){let t=e.mapResult(this.from,1),n=e.mapResult(this.to,-1);return t.deleted&&n.deleted||t.pos>=n.pos?null:new i(t.pos,n.pos,this.mark)}merge(e){return e instanceof i&&e.mark.eq(this.mark)&&this.from<=e.to&&this.to>=e.from?new i(Math.min(this.from,e.from),Math.max(this.to,e.to),this.mark):null}toJSON(){return{stepType:"removeMark",mark:this.mark.toJSON(),from:this.from,to:this.to}}static fromJSON(e,t){if(typeof t.from!="number"||typeof t.to!="number")throw new RangeError("Invalid input for RemoveMarkStep.fromJSON");return new i(t.from,t.to,e.markFromJSON(t.mark))}};k.jsonID("removeMark",F);var Y=class i extends k{constructor(e,t){super(),this.pos=e,this.mark=t}apply(e){let t=e.nodeAt(this.pos);if(!t)return S.fail("No node at mark step's position");let n=t.type.create(t.attrs,null,this.mark.addToSet(t.marks));return S.fromReplace(e,this.pos,this.pos+1,new g(p.from(n),0,t.isLeaf?0:1))}invert(e){let t=e.nodeAt(this.pos);if(t){let n=this.mark.addToSet(t.marks);if(n.length==t.marks.length){for(let r=0;r<t.marks.length;r++)if(!t.marks[r].isInSet(n))return new i(this.pos,t.marks[r]);return new i(this.pos,this.mark)}}return new Z(this.pos,this.mark)}map(e){let t=e.mapResult(this.pos,1);return t.deletedAfter?null:new i(t.pos,this.mark)}toJSON(){return{stepType:"addNodeMark",pos:this.pos,mark:this.mark.toJSON()}}static fromJSON(e,t){if(typeof t.pos!="number")throw new RangeError("Invalid input for AddNodeMarkStep.fromJSON");return new i(t.pos,e.markFromJSON(t.mark))}};k.jsonID("addNodeMark",Y);var Z=class i extends k{constructor(e,t){super(),this.pos=e,this.mark=t}apply(e){let t=e.nodeAt(this.pos);if(!t)return S.fail("No node at mark step's position");let n=t.type.create(t.attrs,null,this.mark.removeFromSet(t.marks));return S.fromReplace(e,this.pos,this.pos+1,new g(p.from(n),0,t.isLeaf?0:1))}invert(e){let t=e.nodeAt(this.pos);return!t||!this.mark.isInSet(t.marks)?this:new Y(this.pos,this.mark)}map(e){let t=e.mapResult(this.pos,1);return t.deletedAfter?null:new i(t.pos,this.mark)}toJSON(){return{stepType:"removeNodeMark",pos:this.pos,mark:this.mark.toJSON()}}static fromJSON(e,t){if(typeof t.pos!="number")throw new RangeError("Invalid input for RemoveNodeMarkStep.fromJSON");return new i(t.pos,e.markFromJSON(t.mark))}};k.jsonID("removeNodeMark",Z);var E=class i extends k{constructor(e,t,n,r=!1){super(),this.from=e,this.to=t,this.slice=n,this.structure=r}apply(e){return this.structure&&be(e,this.from,this.to)?S.fail("Structure replace would overwrite content"):S.fromReplace(e,this.from,this.to,this.slice)}getMap(){return new C([this.from,this.to-this.from,this.slice.size])}invert(e){return new i(this.from,this.from+this.slice.size,e.slice(this.from,this.to))}map(e){let t=e.mapResult(this.from,1),n=e.mapResult(this.to,-1);return t.deletedAcross&&n.deletedAcross?null:new i(t.pos,Math.max(t.pos,n.pos),this.slice)}merge(e){if(!(e instanceof i)||e.structure||this.structure)return null;if(this.from+this.slice.size==e.from&&!this.slice.openEnd&&!e.slice.openStart){let t=this.slice.size+e.slice.size==0?g.empty:new g(this.slice.content.append(e.slice.content),this.slice.openStart,e.slice.openEnd);return new i(this.from,this.to+(e.to-e.from),t,this.structure)}else if(e.to==this.from&&!this.slice.openStart&&!e.slice.openEnd){let t=this.slice.size+e.slice.size==0?g.empty:new g(e.slice.content.append(this.slice.content),e.slice.openStart,this.slice.openEnd);return new i(e.from,this.to,t,this.structure)}else return null}toJSON(){let e={stepType:"replace",from:this.from,to:this.to};return this.slice.size&&(e.slice=this.slice.toJSON()),this.structure&&(e.structure=!0),e}static fromJSON(e,t){if(typeof t.from!="number"||typeof t.to!="number")throw new RangeError("Invalid input for ReplaceStep.fromJSON");return new i(t.from,t.to,g.fromJSON(e,t.slice),!!t.structure)}};k.jsonID("replace",E);var O=class i extends k{constructor(e,t,n,r,s,l,o=!1){super(),this.from=e,this.to=t,this.gapFrom=n,this.gapTo=r,this.slice=s,this.insert=l,this.structure=o}apply(e){if(this.structure&&(be(e,this.from,this.gapFrom)||be(e,this.gapTo,this.to)))return S.fail("Structure gap-replace would overwrite content");let t=e.slice(this.gapFrom,this.gapTo);if(t.openStart||t.openEnd)return S.fail("Gap is not a flat range");let n=this.slice.insertAt(this.insert,t.content);return n?S.fromReplace(e,this.from,this.to,n):S.fail("Content does not fit in gap")}getMap(){return new C([this.from,this.gapFrom-this.from,this.insert,this.gapTo,this.to-this.gapTo,this.slice.size-this.insert])}invert(e){let t=this.gapTo-this.gapFrom;return new i(this.from,this.from+this.slice.size+t,this.from+this.insert,this.from+this.insert+t,e.slice(this.from,this.to).removeBetween(this.gapFrom-this.from,this.gapTo-this.from),this.gapFrom-this.from,this.structure)}map(e){let t=e.mapResult(this.from,1),n=e.mapResult(this.to,-1),r=this.from==this.gapFrom?t.pos:e.map(this.gapFrom,-1),s=this.to==this.gapTo?n.pos:e.map(this.gapTo,1);return t.deletedAcross&&n.deletedAcross||r<t.pos||s>n.pos?null:new i(t.pos,n.pos,r,s,this.slice,this.insert,this.structure)}toJSON(){let e={stepType:"replaceAround",from:this.from,to:this.to,gapFrom:this.gapFrom,gapTo:this.gapTo,insert:this.insert};return this.slice.size&&(e.slice=this.slice.toJSON()),this.structure&&(e.structure=!0),e}static fromJSON(e,t){if(typeof t.from!="number"||typeof t.to!="number"||typeof t.gapFrom!="number"||typeof t.gapTo!="number"||typeof t.insert!="number")throw new RangeError("Invalid input for ReplaceAroundStep.fromJSON");return new i(t.from,t.to,t.gapFrom,t.gapTo,g.fromJSON(e,t.slice),t.insert,!!t.structure)}};k.jsonID("replaceAround",O);function be(i,e,t){let n=i.resolve(e),r=t-e,s=n.depth;for(;r>0&&s>0&&n.indexAfter(s)==n.node(s).childCount;)s--,r--;if(r>0){let l=n.node(s).maybeChild(n.indexAfter(s));for(;r>0;){if(!l||l.isLeaf)return!0;l=l.firstChild,r--}}return!1}function rn(i,e,t,n){let r=[],s=[],l,o;i.doc.nodesBetween(e,t,(h,a,c)=>{if(!h.isInline)return;let f=h.marks;if(!n.isInSet(f)&&c.type.allowsMarkType(n.type)){let u=Math.max(a,e),d=Math.min(a+h.nodeSize,t),m=n.addToSet(f);for(let y=0;y<f.length;y++)f[y].isInSet(m)||(l&&l.to==u&&l.mark.eq(f[y])?l.to=d:r.push(l=new F(u,d,f[y])));o&&o.to==u?o.to=d:s.push(o=new X(u,d,n))}}),r.forEach(h=>i.step(h)),s.forEach(h=>i.step(h))}function sn(i,e,t,n){let r=[],s=0;i.doc.nodesBetween(e,t,(l,o)=>{if(!l.isInline)return;s++;let h=null;if(n instanceof V){let a=l.marks,c;for(;c=n.isInSet(a);)(h||(h=[])).push(c),a=c.removeFromSet(a)}else n?n.isInSet(l.marks)&&(h=[n]):h=l.marks;if(h&&h.length){let a=Math.min(o+l.nodeSize,t);for(let c=0;c<h.length;c++){let f=h[c],u;for(let d=0;d<r.length;d++){let m=r[d];m.step==s-1&&f.eq(r[d].style)&&(u=m)}u?(u.to=a,u.step=s):r.push({style:f,from:Math.max(o,e),to:a,step:s})}}}),r.forEach(l=>i.step(new F(l.from,l.to,l.style)))}function Te(i,e,t,n=t.contentMatch,r=!0){let s=i.doc.nodeAt(e),l=[],o=e+1;for(let h=0;h<s.childCount;h++){let a=s.child(h),c=o+a.nodeSize,f=n.matchType(a.type);if(!f)l.push(new E(o,c,g.empty));else{n=f;for(let u=0;u<a.marks.length;u++)t.allowsMarkType(a.marks[u].type)||i.step(new F(o,c,a.marks[u]));if(r&&a.isText&&t.whitespace!="pre"){let u,d=/\r?\n|\r/g,m;for(;u=d.exec(a.text);)m||(m=new g(p.from(t.schema.text(" ",t.allowedMarks(a.marks))),0,0)),l.push(new E(o+u.index,o+u.index+u[0].length,m))}}o=c}if(!n.validEnd){let h=n.fillBefore(p.empty,!0);i.replace(o,o,new g(h,0,0))}for(let h=l.length-1;h>=0;h--)i.step(l[h])}function ln(i,e,t){return(e==0||i.canReplace(e,i.childCount))&&(t==i.childCount||i.canReplace(0,t))}function Rn(i){let t=i.parent.content.cutByIndex(i.startIndex,i.endIndex);for(let n=i.depth;;--n){let r=i.$from.node(n),s=i.$from.index(n),l=i.$to.indexAfter(n);if(n<i.depth&&r.canReplace(s,l,t))return n;if(n==0||r.type.spec.isolating||!ln(r,s,l))break}return null}function on(i,e,t){let{$from:n,$to:r,depth:s}=e,l=n.before(s+1),o=r.after(s+1),h=l,a=o,c=p.empty,f=0;for(let m=s,y=!1;m>t;m--)y||n.index(m)>0?(y=!0,c=p.from(n.node(m).copy(c)),f++):h--;let u=p.empty,d=0;for(let m=s,y=!1;m>t;m--)y||r.after(m+1)<r.end(m)?(y=!0,u=p.from(r.node(m).copy(u)),d++):a++;i.step(new O(h,a,l,o,new g(c.append(u),f,d),c.size-f,!0))}function In(i,e,t=null,n=i){let r=hn(i,e),s=r&&an(n,e);return s?r.map(ct).concat({type:e,attrs:t}).concat(s.map(ct)):null}function ct(i){return{type:i,attrs:null}}function hn(i,e){let{parent:t,startIndex:n,endIndex:r}=i,s=t.contentMatchAt(n).findWrapping(e);if(!s)return null;let l=s.length?s[0]:e;return t.canReplaceWith(n,r,l)?s:null}function an(i,e){let{parent:t,startIndex:n,endIndex:r}=i,s=t.child(n),l=e.contentMatch.findWrapping(s.type);if(!l)return null;let h=(l.length?l[l.length-1]:e).contentMatch;for(let a=n;h&&a<r;a++)h=h.matchType(t.child(a).type);return!h||!h.validEnd?null:l}function cn(i,e,t){let n=p.empty;for(let l=t.length-1;l>=0;l--){if(n.size){let o=t[l].type.contentMatch.matchFragment(n);if(!o||!o.validEnd)throw new RangeError("Wrapper type given to Transform.wrap does not form valid content of its parent wrapper")}n=p.from(t[l].type.create(t[l].attrs,n))}let r=e.start,s=e.end;i.step(new O(r,s,r,s,new g(n,0,0),t.length,!0))}function fn(i,e,t,n,r){if(!n.isTextblock)throw new RangeError("Type given to setBlockType should be a textblock");let s=i.steps.length;i.doc.nodesBetween(e,t,(l,o)=>{let h=typeof r=="function"?r(l):r;if(l.isTextblock&&!l.hasMarkup(n,h)&&un(i.doc,i.mapping.slice(s).map(o),n)){let a=null;if(n.schema.linebreakReplacement){let d=n.whitespace=="pre",m=!!n.contentMatch.matchType(n.schema.linebreakReplacement);d&&!m?a=!1:!d&&m&&(a=!0)}a===!1&&yt(i,l,o,s),Te(i,i.mapping.slice(s).map(o,1),n,void 0,a===null);let c=i.mapping.slice(s),f=c.map(o,1),u=c.map(o+l.nodeSize,1);return i.step(new O(f,u,f+1,u-1,new g(p.from(n.create(h,null,l.marks)),0,0),1,!0)),a===!0&&gt(i,l,o,s),!1}})}function gt(i,e,t,n){e.forEach((r,s)=>{if(r.isText){let l,o=/\r?\n|\r/g;for(;l=o.exec(r.text);){let h=i.mapping.slice(n).map(t+1+s+l.index);i.replaceWith(h,h+1,e.type.schema.linebreakReplacement.create())}}})}function yt(i,e,t,n){e.forEach((r,s)=>{if(r.type==r.type.schema.linebreakReplacement){let l=i.mapping.slice(n).map(t+1+s);i.replaceWith(l,l+1,e.type.schema.text(`
`))}})}function un(i,e,t){let n=i.resolve(e),r=n.index();return n.parent.canReplaceWith(r,r+1,t)}function pn(i,e,t,n,r){let s=i.doc.nodeAt(e);if(!s)throw new RangeError("No node at given position");t||(t=s.type);let l=t.create(n,null,r||s.marks);if(s.isLeaf)return i.replaceWith(e,e+s.nodeSize,l);if(!t.validContent(s.content))throw new RangeError("Invalid content for node type "+t.name);i.step(new O(e,e+s.nodeSize,e+1,e+s.nodeSize-1,new g(p.from(l),0,0),1,!0))}function An(i,e,t=1,n){let r=i.resolve(e),s=r.depth-t,l=n&&n[n.length-1]||r.parent;if(s<0||r.parent.type.spec.isolating||!r.parent.canReplace(r.index(),r.parent.childCount)||!l.type.validContent(r.parent.content.cutByIndex(r.index(),r.parent.childCount)))return!1;for(let a=r.depth-1,c=t-2;a>s;a--,c--){let f=r.node(a),u=r.index(a);if(f.type.spec.isolating)return!1;let d=f.content.cutByIndex(u,f.childCount),m=n&&n[c+1];m&&(d=d.replaceChild(0,m.type.create(m.attrs)));let y=n&&n[c]||f;if(!f.canReplace(u+1,f.childCount)||!y.type.validContent(d))return!1}let o=r.indexAfter(s),h=n&&n[0];return r.node(s).canReplaceWith(o,o,h?h.type:r.node(s+1).type)}function dn(i,e,t=1,n){let r=i.doc.resolve(e),s=p.empty,l=p.empty;for(let o=r.depth,h=r.depth-t,a=t-1;o>h;o--,a--){s=p.from(r.node(o).copy(s));let c=n&&n[a];l=p.from(c?c.type.create(c.attrs,l):r.node(o).copy(l))}i.step(new E(e,e,new g(s.append(l),t,t),!0))}function zn(i,e){let t=i.resolve(e),n=t.index();return wt(t.nodeBefore,t.nodeAfter)&&t.parent.canReplace(n,n+1)}function mn(i,e){e.content.size||i.type.compatibleContent(e.type);let t=i.contentMatchAt(i.childCount),{linebreakReplacement:n}=i.type.schema;for(let r=0;r<e.childCount;r++){let s=e.child(r),l=s.type==n?i.type.schema.nodes.text:s.type;if(t=t.matchType(l),!t||!i.type.allowsMarks(s.marks))return!1}return t.validEnd}function wt(i,e){return!!(i&&e&&!i.isLeaf&&mn(i,e))}function Fn(i,e,t=-1){let n=i.resolve(e);for(let r=n.depth;;r--){let s,l,o=n.index(r);if(r==n.depth?(s=n.nodeBefore,l=n.nodeAfter):t>0?(s=n.node(r+1),o++,l=n.node(r).maybeChild(o)):(s=n.node(r).maybeChild(o-1),l=n.node(r+1)),s&&!s.isTextblock&&wt(s,l)&&n.node(r).canReplace(o,o+1))return e;if(r==0)break;e=t<0?n.before(r):n.after(r)}}function gn(i,e,t){let n=null,{linebreakReplacement:r}=i.doc.type.schema,s=i.doc.resolve(e-t),l=s.node().type;if(r&&l.inlineContent){let c=l.whitespace=="pre",f=!!l.contentMatch.matchType(r);c&&!f?n=!1:!c&&f&&(n=!0)}let o=i.steps.length;if(n===!1){let c=i.doc.resolve(e+t);yt(i,c.node(),c.before(),o)}l.inlineContent&&Te(i,e+t-1,l,s.node().contentMatchAt(s.index()),n==null);let h=i.mapping.slice(o),a=h.map(e-t);if(i.step(new E(a,h.map(e+t,-1),g.empty,!0)),n===!0){let c=i.doc.resolve(a);gt(i,c.node(),c.before(),i.steps.length)}return i}function yn(i,e,t){let n=i.resolve(e);if(n.parent.canReplaceWith(n.index(),n.index(),t))return e;if(n.parentOffset==0)for(let r=n.depth-1;r>=0;r--){let s=n.index(r);if(n.node(r).canReplaceWith(s,s,t))return n.before(r+1);if(s>0)return null}if(n.parentOffset==n.parent.content.size)for(let r=n.depth-1;r>=0;r--){let s=n.indexAfter(r);if(n.node(r).canReplaceWith(s,s,t))return n.after(r+1);if(s<n.node(r).childCount)return null}return null}function Jn(i,e,t){let n=i.resolve(e);if(!t.content.size)return e;let r=t.content;for(let s=0;s<t.openStart;s++)r=r.firstChild.content;for(let s=1;s<=(t.openStart==0&&t.size?2:1);s++)for(let l=n.depth;l>=0;l--){let o=l==n.depth?0:n.pos<=(n.start(l+1)+n.end(l+1))/2?-1:1,h=n.index(l)+(o>0?1:0),a=n.node(l),c=!1;if(s==1)c=a.canReplace(h,h,r);else{let f=a.contentMatchAt(h).findWrapping(r.firstChild.type);c=f&&a.canReplaceWith(h,h,f[0])}if(c)return o==0?n.pos:o<0?n.before(l+1):n.after(l+1)}return null}function wn(i,e,t=e,n=g.empty){if(e==t&&!n.size)return null;let r=i.resolve(e),s=i.resolve(t);return xt(r,s,n)?new E(e,t,n):new Oe(r,s,n).fit()}function xt(i,e,t){return!t.openStart&&!t.openEnd&&i.start()==e.start()&&i.parent.canReplace(i.index(),e.index(),t.content)}var Oe=class{constructor(e,t,n){this.$from=e,this.$to=t,this.unplaced=n,this.frontier=[],this.placed=p.empty;for(let r=0;r<=e.depth;r++){let s=e.node(r);this.frontier.push({type:s.type,match:s.contentMatchAt(e.indexAfter(r))})}for(let r=e.depth;r>0;r--)this.placed=p.from(e.node(r).copy(this.placed))}get depth(){return this.frontier.length-1}fit(){for(;this.unplaced.size;){let a=this.findFittable();a?this.placeNodes(a):this.openMore()||this.dropNode()}let e=this.mustMoveInline(),t=this.placed.size-this.depth-this.$from.depth,n=this.$from,r=this.close(e<0?this.$to:n.doc.resolve(e));if(!r)return null;let s=this.placed,l=n.depth,o=r.depth;for(;l&&o&&s.childCount==1;)s=s.firstChild.content,l--,o--;let h=new g(s,l,o);return e>-1?new O(n.pos,e,this.$to.pos,this.$to.end(),h,t):h.size||n.pos!=this.$to.pos?new E(n.pos,r.pos,h):null}findFittable(){let e=this.unplaced.openStart;for(let t=this.unplaced.content,n=0,r=this.unplaced.openEnd;n<e;n++){let s=t.firstChild;if(t.childCount>1&&(r=0),s.type.spec.isolating&&r<=n){e=n;break}t=s.content}for(let t=1;t<=2;t++)for(let n=t==1?e:this.unplaced.openStart;n>=0;n--){let r,s=null;n?(s=ve(this.unplaced.content,n-1).firstChild,r=s.content):r=this.unplaced.content;let l=r.firstChild;for(let o=this.depth;o>=0;o--){let{type:h,match:a}=this.frontier[o],c,f=null;if(t==1&&(l?a.matchType(l.type)||(f=a.fillBefore(p.from(l),!1)):s&&h.compatibleContent(s.type)))return{sliceDepth:n,frontierDepth:o,parent:s,inject:f};if(t==2&&l&&(c=a.findWrapping(l.type)))return{sliceDepth:n,frontierDepth:o,parent:s,wrap:c};if(s&&a.matchType(s.type))break}}}openMore(){let{content:e,openStart:t,openEnd:n}=this.unplaced,r=ve(e,t);return!r.childCount||r.firstChild.isLeaf?!1:(this.unplaced=new g(e,t+1,Math.max(n,r.size+t>=e.size-n?t+1:0)),!0)}dropNode(){let{content:e,openStart:t,openEnd:n}=this.unplaced,r=ve(e,t);if(r.childCount<=1&&t>0){let s=e.size-t<=t+r.size;this.unplaced=new g(H(e,t-1,1),t-1,s?t-1:n)}else this.unplaced=new g(H(e,t,1),t,n)}placeNodes({sliceDepth:e,frontierDepth:t,parent:n,inject:r,wrap:s}){for(;this.depth>t;)this.closeFrontierNode();if(s)for(let y=0;y<s.length;y++)this.openFrontierNode(s[y]);let l=this.unplaced,o=n?n.content:l.content,h=l.openStart-e,a=0,c=[],{match:f,type:u}=this.frontier[t];if(r){for(let y=0;y<r.childCount;y++)c.push(r.child(y));f=f.matchFragment(r)}let d=o.size+e-(l.content.size-l.openEnd);for(;a<o.childCount;){let y=o.child(a),M=f.matchType(y.type);if(!M)break;a++,(a>1||h==0||y.content.size)&&(f=M,c.push(kt(y.mark(u.allowedMarks(y.marks)),a==1?h:0,a==o.childCount?d:-1)))}let m=a==o.childCount;m||(d=-1),this.placed=K(this.placed,t,p.from(c)),this.frontier[t].match=f,m&&d<0&&n&&n.type==this.frontier[this.depth].type&&this.frontier.length>1&&this.closeFrontierNode();for(let y=0,M=o;y<d;y++){let N=M.lastChild;this.frontier.push({type:N.type,match:N.contentMatchAt(N.childCount)}),M=N.content}this.unplaced=m?e==0?g.empty:new g(H(l.content,e-1,1),e-1,d<0?l.openEnd:e-1):new g(H(l.content,e,a),l.openStart,l.openEnd)}mustMoveInline(){if(!this.$to.parent.isTextblock)return-1;let e=this.frontier[this.depth],t;if(!e.type.isTextblock||!Me(this.$to,this.$to.depth,e.type,e.match,!1)||this.$to.depth==this.depth&&(t=this.findCloseLevel(this.$to))&&t.depth==this.depth)return-1;let{depth:n}=this.$to,r=this.$to.after(n);for(;n>1&&r==this.$to.end(--n);)++r;return r}findCloseLevel(e){e:for(let t=Math.min(this.depth,e.depth);t>=0;t--){let{match:n,type:r}=this.frontier[t],s=t<e.depth&&e.end(t+1)==e.pos+(e.depth-(t+1)),l=Me(e,t,r,n,s);if(l){for(let o=t-1;o>=0;o--){let{match:h,type:a}=this.frontier[o],c=Me(e,o,a,h,!0);if(!c||c.childCount)continue e}return{depth:t,fit:l,move:s?e.doc.resolve(e.after(t+1)):e}}}}close(e){let t=this.findCloseLevel(e);if(!t)return null;for(;this.depth>t.depth;)this.closeFrontierNode();t.fit.childCount&&(this.placed=K(this.placed,t.depth,t.fit)),e=t.move;for(let n=t.depth+1;n<=e.depth;n++){let r=e.node(n),s=r.type.contentMatch.fillBefore(r.content,!0,e.index(n));this.openFrontierNode(r.type,r.attrs,s)}return e}openFrontierNode(e,t=null,n){let r=this.frontier[this.depth];r.match=r.match.matchType(e),this.placed=K(this.placed,this.depth,p.from(e.create(t,n))),this.frontier.push({type:e,match:e.contentMatch})}closeFrontierNode(){let t=this.frontier.pop().match.fillBefore(p.empty,!0);t.childCount&&(this.placed=K(this.placed,this.frontier.length,t))}};function H(i,e,t){return e==0?i.cutByIndex(t,i.childCount):i.replaceChild(0,i.firstChild.copy(H(i.firstChild.content,e-1,t)))}function K(i,e,t){return e==0?i.append(t):i.replaceChild(i.childCount-1,i.lastChild.copy(K(i.lastChild.content,e-1,t)))}function ve(i,e){for(let t=0;t<e;t++)i=i.firstChild.content;return i}function kt(i,e,t){if(e<=0)return i;let n=i.content;return e>1&&(n=n.replaceChild(0,kt(n.firstChild,e-1,n.childCount==1?t-1:0))),e>0&&(n=i.type.contentMatch.fillBefore(n).append(n),t<=0&&(n=n.append(i.type.contentMatch.matchFragment(n).fillBefore(p.empty,!0)))),i.copy(n)}function Me(i,e,t,n,r){let s=i.node(e),l=r?i.indexAfter(e):i.index(e);if(l==s.childCount&&!t.compatibleContent(s.type))return null;let o=n.fillBefore(s.content,!0,l);return o&&!xn(t,s.content,l)?o:null}function xn(i,e,t){for(let n=t;n<e.childCount;n++)if(!i.allowsMarks(e.child(n).marks))return!0;return!1}function kn(i){return i.spec.defining||i.spec.definingForContent}function Sn(i,e,t,n){if(!n.size)return i.deleteRange(e,t);let r=i.doc.resolve(e),s=i.doc.resolve(t);if(xt(r,s,n))return i.step(new E(e,t,n));let l=vt(r,i.doc.resolve(t));l[l.length-1]==0&&l.pop();let o=-(r.depth+1);l.unshift(o);for(let u=r.depth,d=r.pos-1;u>0;u--,d--){let m=r.node(u).type.spec;if(m.defining||m.definingAsContext||m.isolating)break;l.indexOf(u)>-1?o=u:r.before(u)==d&&l.splice(1,0,-u)}let h=l.indexOf(o),a=[],c=n.openStart;for(let u=n.content,d=0;;d++){let m=u.firstChild;if(a.push(m),d==n.openStart)break;u=m.content}for(let u=c-1;u>=0;u--){let d=a[u],m=kn(d.type);if(m&&!d.sameMarkup(r.node(Math.abs(o)-1)))c=u;else if(m||!d.type.isTextblock)break}for(let u=n.openStart;u>=0;u--){let d=(u+c+1)%(n.openStart+1),m=a[d];if(m)for(let y=0;y<l.length;y++){let M=l[(y+h)%l.length],N=!0;M<0&&(N=!1,M=-M);let Ft=r.node(M-1),Fe=r.index(M-1);if(Ft.canReplaceWith(Fe,Fe,m.type,m.marks))return i.replace(r.before(M),N?s.after(M):t,new g(St(n.content,0,n.openStart,d),d,n.openEnd))}}let f=i.steps.length;for(let u=l.length-1;u>=0&&(i.replace(e,t,n),!(i.steps.length>f));u--){let d=l[u];d<0||(e=r.before(d),t=s.after(d))}}function St(i,e,t,n,r){if(e<t){let s=i.firstChild;i=i.replaceChild(0,s.copy(St(s.content,e+1,t,n,s)))}if(e>n){let s=r.contentMatchAt(0),l=s.fillBefore(i).append(i);i=l.append(s.matchFragment(l).fillBefore(p.empty,!0))}return i}function vn(i,e,t,n){if(!n.isInline&&e==t&&i.doc.resolve(e).parent.content.size){let r=yn(i.doc,e,n.type);r!=null&&(e=t=r)}i.replaceRange(e,t,new g(p.from(n),0,0))}function Mn(i,e,t){let n=i.doc.resolve(e),r=i.doc.resolve(t),s=vt(n,r);for(let l=0;l<s.length;l++){let o=s[l],h=l==s.length-1;if(h&&o==0||n.node(o).type.contentMatch.validEnd)return i.delete(n.start(o),r.end(o));if(o>0&&(h||n.node(o-1).canReplace(n.index(o-1),r.indexAfter(o-1))))return i.delete(n.before(o),r.after(o))}for(let l=1;l<=n.depth&&l<=r.depth;l++)if(e-n.start(l)==n.depth-l&&t>n.end(l)&&r.end(l)-t!=r.depth-l&&n.start(l-1)==r.start(l-1)&&n.node(l-1).canReplace(n.index(l-1),r.index(l-1)))return i.delete(n.before(l),t);i.delete(e,t)}function vt(i,e){let t=[],n=Math.min(i.depth,e.depth);for(let r=n;r>=0;r--){let s=i.start(r);if(s<i.pos-(i.depth-r)||e.end(r)>e.pos+(e.depth-r)||i.node(r).type.spec.isolating||e.node(r).type.spec.isolating)break;(s==e.start(r)||r==i.depth&&r==e.depth&&i.parent.inlineContent&&e.parent.inlineContent&&r&&e.start(r-1)==s-1)&&t.push(r)}return t}var le=class i extends k{constructor(e,t,n){super(),this.pos=e,this.attr=t,this.value=n}apply(e){let t=e.nodeAt(this.pos);if(!t)return S.fail("No node at attribute step's position");let n=Object.create(null);for(let s in t.attrs)n[s]=t.attrs[s];n[this.attr]=this.value;let r=t.type.create(n,null,t.marks);return S.fromReplace(e,this.pos,this.pos+1,new g(p.from(r),0,t.isLeaf?0:1))}getMap(){return C.empty}invert(e){return new i(this.pos,this.attr,e.nodeAt(this.pos).attrs[this.attr])}map(e){let t=e.mapResult(this.pos,1);return t.deletedAfter?null:new i(t.pos,this.attr,this.value)}toJSON(){return{stepType:"attr",pos:this.pos,attr:this.attr,value:this.value}}static fromJSON(e,t){if(typeof t.pos!="number"||typeof t.attr!="string")throw new RangeError("Invalid input for AttrStep.fromJSON");return new i(t.pos,t.attr,t.value)}};k.jsonID("attr",le);var oe=class i extends k{constructor(e,t){super(),this.attr=e,this.value=t}apply(e){let t=Object.create(null);for(let r in e.attrs)t[r]=e.attrs[r];t[this.attr]=this.value;let n=e.type.create(t,e.content,e.marks);return S.ok(n)}getMap(){return C.empty}invert(e){return new i(this.attr,e.attrs[this.attr])}map(e){return this}toJSON(){return{stepType:"docAttr",attr:this.attr,value:this.value}}static fromJSON(e,t){if(typeof t.attr!="string")throw new RangeError("Invalid input for DocAttrStep.fromJSON");return new i(t.attr,t.value)}};k.jsonID("docAttr",oe);var P=class extends Error{};P=function i(e){let t=Error.call(this,e);return t.__proto__=i.prototype,t};P.prototype=Object.create(Error.prototype);P.prototype.constructor=P;P.prototype.name="TransformError";var he=class{constructor(e){this.doc=e,this.steps=[],this.docs=[],this.mapping=new Ee}get before(){return this.docs.length?this.docs[0]:this.doc}step(e){let t=this.maybeStep(e);if(t.failed)throw new P(t.failed);return this}maybeStep(e){let t=e.apply(this.doc);return t.failed||this.addStep(e,t.doc),t}get docChanged(){return this.steps.length>0}addStep(e,t){this.docs.push(this.doc),this.steps.push(e),this.mapping.appendMap(e.getMap()),this.doc=t}replace(e,t=e,n=g.empty){let r=wn(this.doc,e,t,n);return r&&this.step(r),this}replaceWith(e,t,n){return this.replace(e,t,new g(p.from(n),0,0))}delete(e,t){return this.replace(e,t,g.empty)}insert(e,t){return this.replaceWith(e,e,t)}replaceRange(e,t,n){return Sn(this,e,t,n),this}replaceRangeWith(e,t,n){return vn(this,e,t,n),this}deleteRange(e,t){return Mn(this,e,t),this}lift(e,t){return on(this,e,t),this}join(e,t=1){return gn(this,e,t),this}wrap(e,t){return cn(this,e,t),this}setBlockType(e,t=e,n,r=null){return fn(this,e,t,n,r),this}setNodeMarkup(e,t,n=null,r){return pn(this,e,t,n,r),this}setNodeAttribute(e,t,n){return this.step(new le(e,t,n)),this}setDocAttribute(e,t){return this.step(new oe(e,t)),this}addNodeMark(e,t){return this.step(new Y(e,t)),this}removeNodeMark(e,t){if(!(t instanceof w)){let n=this.doc.nodeAt(e);if(!n)throw new RangeError("No node at position "+e);if(t=t.isInSet(n.marks),!t)return this}return this.step(new Z(e,t)),this}split(e,t=1,n){return dn(this,e,t,n),this}addMark(e,t,n){return rn(this,e,t,n),this}removeMark(e,t,n){return sn(this,e,t,n),this}clearIncompatible(e,t,n){return Te(this,e,t,n),this}};var Ne=Object.create(null),x=class{constructor(e,t,n){this.$anchor=e,this.$head=t,this.ranges=n||[new Ie(e.min(t),e.max(t))]}get anchor(){return this.$anchor.pos}get head(){return this.$head.pos}get from(){return this.$from.pos}get to(){return this.$to.pos}get $from(){return this.ranges[0].$from}get $to(){return this.ranges[0].$to}get empty(){let e=this.ranges;for(let t=0;t<e.length;t++)if(e[t].$from.pos!=e[t].$to.pos)return!1;return!0}content(){return this.$from.doc.slice(this.from,this.to,!0)}replace(e,t=g.empty){let n=t.content.lastChild,r=null;for(let o=0;o<t.openEnd;o++)r=n,n=n.lastChild;let s=e.steps.length,l=this.ranges;for(let o=0;o<l.length;o++){let{$from:h,$to:a}=l[o],c=e.mapping.slice(s);e.replaceRange(c.map(h.pos),c.map(a.pos),o?g.empty:t),o==0&&bt(e,s,(n?n.isInline:r&&r.isTextblock)?-1:1)}}replaceWith(e,t){let n=e.steps.length,r=this.ranges;for(let s=0;s<r.length;s++){let{$from:l,$to:o}=r[s],h=e.mapping.slice(n),a=h.map(l.pos),c=h.map(o.pos);s?e.deleteRange(a,c):(e.replaceRangeWith(a,c,t),bt(e,n,t.isInline?-1:1))}}static findFrom(e,t,n=!1){let r=e.parent.inlineContent?new B(e):L(e.node(0),e.parent,e.pos,e.index(),t,n);if(r)return r;for(let s=e.depth-1;s>=0;s--){let l=t<0?L(e.node(0),e.node(s),e.before(s+1),e.index(s),t,n):L(e.node(0),e.node(s),e.after(s+1),e.index(s)+1,t,n);if(l)return l}return null}static near(e,t=1){return this.findFrom(e,t)||this.findFrom(e,-t)||new D(e.node(0))}static atStart(e){return L(e,e,0,0,1)||new D(e)}static atEnd(e){return L(e,e,e.content.size,e.childCount,-1)||new D(e)}static fromJSON(e,t){if(!t||!t.type)throw new RangeError("Invalid input for Selection.fromJSON");let n=Ne[t.type];if(!n)throw new RangeError(`No selection type ${t.type} defined`);return n.fromJSON(e,t)}static jsonID(e,t){if(e in Ne)throw new RangeError("Duplicate use of selection JSON ID "+e);return Ne[e]=t,t.prototype.jsonID=e,t}getBookmark(){return B.between(this.$anchor,this.$head).getBookmark()}};x.prototype.visible=!0;var Ie=class{constructor(e,t){this.$from=e,this.$to=t}},Mt=!1;function Et(i){!Mt&&!i.parent.inlineContent&&(Mt=!0,console.warn("TextSelection endpoint not pointing into a node with inline content ("+i.parent.type.name+")"))}var B=class i extends x{constructor(e,t=e){Et(e),Et(t),super(e,t)}get $cursor(){return this.$anchor.pos==this.$head.pos?this.$head:null}map(e,t){let n=e.resolve(t.map(this.head));if(!n.parent.inlineContent)return x.near(n);let r=e.resolve(t.map(this.anchor));return new i(r.parent.inlineContent?r:n,n)}replace(e,t=g.empty){if(super.replace(e,t),t==g.empty){let n=this.$from.marksAcross(this.$to);n&&e.ensureMarks(n)}}eq(e){return e instanceof i&&e.anchor==this.anchor&&e.head==this.head}getBookmark(){return new ce(this.anchor,this.head)}toJSON(){return{type:"text",anchor:this.anchor,head:this.head}}static fromJSON(e,t){if(typeof t.anchor!="number"||typeof t.head!="number")throw new RangeError("Invalid input for TextSelection.fromJSON");return new i(e.resolve(t.anchor),e.resolve(t.head))}static create(e,t,n=t){let r=e.resolve(t);return new this(r,n==t?r:e.resolve(n))}static between(e,t,n){let r=e.pos-t.pos;if((!n||r)&&(n=r>=0?1:-1),!t.parent.inlineContent){let s=x.findFrom(t,n,!0)||x.findFrom(t,-n,!0);if(s)t=s.$head;else return x.near(t,n)}return e.parent.inlineContent||(r==0?e=t:(e=(x.findFrom(e,-n,!0)||x.findFrom(e,n,!0)).$anchor,e.pos<t.pos!=r<0&&(e=t))),new i(e,t)}};x.jsonID("text",B);var ce=class i{constructor(e,t){this.anchor=e,this.head=t}map(e){return new i(e.map(this.anchor),e.map(this.head))}resolve(e){return B.between(e.resolve(this.anchor),e.resolve(this.head))}},T=class i extends x{constructor(e){let t=e.nodeAfter,n=e.node(0).resolve(e.pos+t.nodeSize);super(e,n),this.node=t}map(e,t){let{deleted:n,pos:r}=t.mapResult(this.anchor),s=e.resolve(r);return n?x.near(s):new i(s)}content(){return new g(p.from(this.node),0,0)}eq(e){return e instanceof i&&e.anchor==this.anchor}toJSON(){return{type:"node",anchor:this.anchor}}getBookmark(){return new Ae(this.anchor)}static fromJSON(e,t){if(typeof t.anchor!="number")throw new RangeError("Invalid input for NodeSelection.fromJSON");return new i(e.resolve(t.anchor))}static create(e,t){return new i(e.resolve(t))}static isSelectable(e){return!e.isText&&e.type.spec.selectable!==!1}};T.prototype.visible=!1;x.jsonID("node",T);var Ae=class i{constructor(e){this.anchor=e}map(e){let{deleted:t,pos:n}=e.mapResult(this.anchor);return t?new ce(n,n):new i(n)}resolve(e){let t=e.resolve(this.anchor),n=t.nodeAfter;return n&&T.isSelectable(n)?new T(t):x.near(t)}},D=class i extends x{constructor(e){super(e.resolve(0),e.resolve(e.content.size))}replace(e,t=g.empty){if(t==g.empty){e.delete(0,e.doc.content.size);let n=x.atStart(e.doc);n.eq(e.selection)||e.setSelection(n)}else super.replace(e,t)}toJSON(){return{type:"all"}}static fromJSON(e){return new i(e)}map(e){return new i(e)}eq(e){return e instanceof i}getBookmark(){return En}};x.jsonID("all",D);var En={map(){return this},resolve(i){return new D(i)}};function L(i,e,t,n,r,s=!1){if(e.inlineContent)return B.create(i,t);for(let l=n-(r>0?0:1);r>0?l<e.childCount:l>=0;l+=r){let o=e.child(l);if(o.isAtom){if(!s&&T.isSelectable(o))return T.create(i,t-(r<0?o.nodeSize:0))}else{let h=L(i,o,t+r,r<0?o.childCount:0,r,s);if(h)return h}t+=o.nodeSize*r}return null}function bt(i,e,t){let n=i.steps.length-1;if(n<e)return;let r=i.steps[n];if(!(r instanceof E||r instanceof O))return;let s=i.mapping.maps[n],l;s.forEach((o,h,a,c)=>{l==null&&(l=c)}),i.setSelection(x.near(i.doc.resolve(l),t))}var Ot=1,ae=2,Ct=4,ze=class extends he{constructor(e){super(e.doc),this.curSelectionFor=0,this.updated=0,this.meta=Object.create(null),this.time=Date.now(),this.curSelection=e.selection,this.storedMarks=e.storedMarks}get selection(){return this.curSelectionFor<this.steps.length&&(this.curSelection=this.curSelection.map(this.doc,this.mapping.slice(this.curSelectionFor)),this.curSelectionFor=this.steps.length),this.curSelection}setSelection(e){if(e.$from.doc!=this.doc)throw new RangeError("Selection passed to setSelection must point at the current document");return this.curSelection=e,this.curSelectionFor=this.steps.length,this.updated=(this.updated|Ot)&~ae,this.storedMarks=null,this}get selectionSet(){return(this.updated&Ot)>0}setStoredMarks(e){return this.storedMarks=e,this.updated|=ae,this}ensureMarks(e){return w.sameSet(this.storedMarks||this.selection.$from.marks(),e)||this.setStoredMarks(e),this}addStoredMark(e){return this.ensureMarks(e.addToSet(this.storedMarks||this.selection.$head.marks()))}removeStoredMark(e){return this.ensureMarks(e.removeFromSet(this.storedMarks||this.selection.$head.marks()))}get storedMarksSet(){return(this.updated&ae)>0}addStep(e,t){super.addStep(e,t),this.updated=this.updated&~ae,this.storedMarks=null}setTime(e){return this.time=e,this}replaceSelection(e){return this.selection.replace(this,e),this}replaceSelectionWith(e,t=!0){let n=this.selection;return t&&(e=e.mark(this.storedMarks||(n.empty?n.$from.marks():n.$from.marksAcross(n.$to)||w.none))),n.replaceWith(this,e),this}deleteSelection(){return this.selection.replace(this),this}insertText(e,t,n){let r=this.doc.type.schema;if(t==null)return e?this.replaceSelectionWith(r.text(e),!0):this.deleteSelection();{if(n==null&&(n=t),n=n??t,!e)return this.deleteRange(t,n);let s=this.storedMarks;if(!s){let l=this.doc.resolve(t);s=n==t?l.marks():l.marksAcross(this.doc.resolve(n))}return this.replaceRangeWith(t,n,r.text(e,s)),this.selection.empty||this.setSelection(x.near(this.selection.$to)),this}}setMeta(e,t){return this.meta[typeof e=="string"?e:e.key]=t,this}getMeta(e){return this.meta[typeof e=="string"?e:e.key]}get isGeneric(){for(let e in this.meta)return!1;return!0}scrollIntoView(){return this.updated|=Ct,this}get scrolledIntoView(){return(this.updated&Ct)>0}};function Tt(i,e){return!e||!i?i:i.bind(e)}var J=class{constructor(e,t,n){this.name=e,this.init=Tt(t.init,n),this.apply=Tt(t.apply,n)}},bn=[new J("doc",{init(i){return i.doc||i.schema.topNodeType.createAndFill()},apply(i){return i.doc}}),new J("selection",{init(i,e){return i.selection||x.atStart(e.doc)},apply(i){return i.selection}}),new J("storedMarks",{init(i){return i.storedMarks||null},apply(i,e,t,n){return n.selection.$cursor?i.storedMarks:null}}),new J("scrollToSelection",{init(){return 0},apply(i,e){return i.scrolledIntoView?e+1:e}})],j=class{constructor(e,t){this.schema=e,this.plugins=[],this.pluginsByKey=Object.create(null),this.fields=bn.slice(),t&&t.forEach(n=>{if(this.pluginsByKey[n.key])throw new RangeError("Adding different instances of a keyed plugin ("+n.key+")");this.plugins.push(n),this.pluginsByKey[n.key]=n,n.spec.state&&this.fields.push(new J(n.key,n.spec.state,n))})}},Nt=class i{constructor(e){this.config=e}get schema(){return this.config.schema}get plugins(){return this.config.plugins}apply(e){return this.applyTransaction(e).state}filterTransaction(e,t=-1){for(let n=0;n<this.config.plugins.length;n++)if(n!=t){let r=this.config.plugins[n];if(r.spec.filterTransaction&&!r.spec.filterTransaction.call(r,e,this))return!1}return!0}applyTransaction(e){if(!this.filterTransaction(e))return{state:this,transactions:[]};let t=[e],n=this.applyInner(e),r=null;for(;;){let s=!1;for(let l=0;l<this.config.plugins.length;l++){let o=this.config.plugins[l];if(o.spec.appendTransaction){let h=r?r[l].n:0,a=r?r[l].state:this,c=h<t.length&&o.spec.appendTransaction.call(o,h?t.slice(h):t,a,n);if(c&&n.filterTransaction(c,l)){if(c.setMeta("appendedTransaction",e),!r){r=[];for(let f=0;f<this.config.plugins.length;f++)r.push(f<l?{state:n,n:t.length}:{state:this,n:0})}t.push(c),n=n.applyInner(c),s=!0}r&&(r[l]={state:n,n:t.length})}}if(!s)return{state:n,transactions:t}}}applyInner(e){if(!e.before.eq(this.doc))throw new RangeError("Applying a mismatched transaction");let t=new i(this.config),n=this.config.fields;for(let r=0;r<n.length;r++){let s=n[r];t[s.name]=s.apply(e,this[s.name],this,t)}return t}get tr(){return new ze(this)}static create(e){let t=new j(e.doc?e.doc.type.schema:e.schema,e.plugins),n=new i(t);for(let r=0;r<t.fields.length;r++)n[t.fields[r].name]=t.fields[r].init(e,n);return n}reconfigure(e){let t=new j(this.schema,e.plugins),n=t.fields,r=new i(t);for(let s=0;s<n.length;s++){let l=n[s].name;r[l]=this.hasOwnProperty(l)?this[l]:n[s].init(e,r)}return r}toJSON(e){let t={doc:this.doc.toJSON(),selection:this.selection.toJSON()};if(this.storedMarks&&(t.storedMarks=this.storedMarks.map(n=>n.toJSON())),e&&typeof e=="object")for(let n in e){if(n=="doc"||n=="selection")throw new RangeError("The JSON fields `doc` and `selection` are reserved");let r=e[n],s=r.spec.state;s&&s.toJSON&&(t[n]=s.toJSON.call(r,this[r.key]))}return t}static fromJSON(e,t,n){if(!t)throw new RangeError("Invalid input for EditorState.fromJSON");if(!e.schema)throw new RangeError("Required config field 'schema' missing");let r=new j(e.schema,e.plugins),s=new i(r);return r.fields.forEach(l=>{if(l.name=="doc")s.doc=b.fromJSON(e.schema,t.doc);else if(l.name=="selection")s.selection=x.fromJSON(s.doc,t.selection);else if(l.name=="storedMarks")t.storedMarks&&(s.storedMarks=t.storedMarks.map(e.schema.markFromJSON));else{if(n)for(let o in n){let h=n[o],a=h.spec.state;if(h.key==l.name&&a&&a.fromJSON&&Object.prototype.hasOwnProperty.call(t,o)){s[l.name]=a.fromJSON.call(h,e,t[o],s);return}}s[l.name]=l.init(e,s)}}),s}};function At(i,e,t){for(let n in i){let r=i[n];r instanceof Function?r=r.bind(e):n=="handleDOMEvents"&&(r=At(r,e,{})),t[n]=r}return t}var Rt=class{constructor(e){this.spec=e,this.props={},e.props&&At(e.props,this,this.props),this.key=e.key?e.key.key:zt("plugin")}getState(e){return e[this.key]}},Re=Object.create(null);function zt(i){return i in Re?i+"$"+ ++Re[i]:(Re[i]=0,i+"$")}var It=class{constructor(e="key"){this.key=zt(e)}get(e){return e.config.pluginsByKey[this.key]}getState(e){return e[this.key]}};export{p as a,w as b,g as c,ge as d,We as e,Le as f,Ge as g,Ee as h,E as i,O as j,Rn as k,In as l,An as m,zn as n,Fn as o,Jn as p,wn as q,he as r,x as s,Ie as t,B as u,T as v,D as w,Nt as x,Rt as y,It as z};
//# sourceMappingURL=https://app.framerstatic.com/chunk-KYPY4QS7.mjs.map
