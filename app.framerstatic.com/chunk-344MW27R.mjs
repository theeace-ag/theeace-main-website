import{c as M,d as P}from"https://app.framerstatic.com/chunk-XGYAAWSK.mjs";import{a as x,b as F}from"https://app.framerstatic.com/chunk-NIDOI5EE.mjs";import{b as S,d as w}from"https://app.framerstatic.com/chunk-AGVZOAU6.mjs";import{c as T}from"https://app.framerstatic.com/chunk-FWMM76SF.mjs";import{e as C,l as g,m as I,v as A}from"https://app.framerstatic.com/chunk-PNIOO2GU.mjs";import{e as R}from"https://app.framerstatic.com/chunk-AHQIRSXG.mjs";var v=R(x());function W(c,h){let d={service:c.service.service,onDiscover:c.onDiscover},m=(0,v.useRef)(d);if(m.current.service!==d.service)throw new Error("useServiceStream: service must be identical between re-renders");let E={onStreamValue:h,onError:c.onError},s=(0,v.useRef)(E);s.current=E;let p=(0,v.useRef)(),f=()=>{let o=p.current;p.current=void 0,o?.cancel().catch(()=>{})},{channel:l}=c;(0,v.useEffect)(()=>l?((async()=>{let r=!1,y=0;for(;!r;){r=!0;try{let e=m.current,n=await w.shared().discover(e.service,l),u=e.onDiscover(n);p.current=u,y=0,await u.read(a=>s.current.onStreamValue(a))}catch(e){let n=s.current.onError(I(e));if(y++,y>1)continue;n?.retry===!0&&(await C(0),r=!1)}}})().catch(g),f):void 0,[l])}function Y(c){if(c instanceof S.ServiceGone)return{retry:!0};g(c)}var t=R(x());var _="autoplay; ambient-light-sensor; accelerometer; camera; display-capture; encrypted-media; fullscreen; geolocation; gyroscope; magnetometer; microphone; midi; picture-in-picture; usb; xr-spatial-tracking",$="autoplay",k="autoplay; ambient-light-sensor; accelerometer; camera; display-capture; encrypted-media; fullscreen; geolocation; gyroscope; magnetometer; microphone; midi; picture-in-picture; usb; xr-spatial-tracking; clipboard-read; clipboard-write";var O=R(F()),H=A("services:hooks:useiframewithchannel"),b=class extends Error{constructor(d,m={}){super(d);this.extras=m}};function J(c){let{onSetup:h=()=>{},targetOrigin:d,type:m,src:E}=c,s=E;if(E){let{pathname:e,search:n,hash:u}=new URL(E),a=`${e}${n}${u}`;P(a),s=M(a).url}let[p,f]=(0,t.useReducer)((e,n)=>(e&&w.shared().unregister(e).catch(u=>{u instanceof S.ServiceGone||g(u)}),n),null),l=(0,t.useRef)(null),o=(0,t.useRef)(null),r=(0,t.useRef)({onError:null,onLoad:null});return(0,t.useEffect)(()=>{if(!s||!l.current){o.current=null,p&&f(null);return}if(o.current)return;let e=document.createElement("iframe");e.src=s,e.style.border="none",e.style.display="block",e.style.height="100%",e.style.width="100%",e.dataset.testid=`${m}-iframe`,e.allowFullscreen=!0;let n=i=>{f(null),H.reportError(new b("iframe load error",{message:i.message,filename:i.filename,lineno:i.lineno,colno:i.colno,error:i.error}))};e.addEventListener("error",n),r.current.onError=n;let u=new URL(s,document.baseURI).origin,a=e.sandbox;a?.add("allow-downloads"),a?.add("allow-popups"),a?.add("allow-popups-to-escape-sandbox"),a?.add("allow-same-origin"),a?.add("allow-scripts"),a?.add("allow-forms"),e.allow=m==="canvas"?_:k,l.current.appendChild(e),o.current=e;let U=()=>{let{contentWindow:i}=e;return i?new T(i,d??u):(l.current?.removeChild(e),null)},L=()=>{let i=U();f(i)};return e.addEventListener("load",L),r.current.onLoad=L,h(e)},[p,f,h,s,d,m]),(0,t.useEffect)(()=>()=>{r.current.onError&&o.current?.removeEventListener("error",r.current.onError),r.current.onLoad&&o.current?.removeEventListener("load",r.current.onLoad),r.current.onError=null,r.current.onLoad=null,o.current=null,f(null)},[]),[(0,t.useCallback)(function(n){return(0,t.useEffect)(()=>{if(l.current?.children.length===0&&o.current)throw new Error("IFrameWithChannel was re-rendered. The Service connection will be broken.")}),(0,O.jsx)("div",{...n,ref:l})},[]),p,o.current]}export{_ as a,$ as b,J as c,W as d,Y as e};
//# sourceMappingURL=https://app.framerstatic.com/chunk-344MW27R.mjs.map
