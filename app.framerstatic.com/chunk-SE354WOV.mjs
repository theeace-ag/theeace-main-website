import{a as P}from"https://app.framerstatic.com/chunk-WNSBRACC.mjs";import{j as i}from"https://app.framerstatic.com/chunk-AHQIRSXG.mjs";var c=',"children":[';var b=["contentManagement","externalModules","localModules","presets","colorStyles","routeSegmentRoot","entityRoot"];function T(a,e,t){return a.slice(e,t+c.length)+"]}"}function w(a,e){let t=`"id":"${e}"`;return a.indexOf(t)>=0}function I(a,e=1){return a.startsWith(`{"v":${e},`)&&a.indexOf(c)>=0&&a.endsWith("]}}")}function R(a,e){if(a!=="children")return e}function E(a,e){let t=JSON.stringify(a,R),n=`${c}${e.join(",")}]`;return`${t.slice(0,-1)}${n}}`}function O(a){if(!a.children)return JSON.stringify(a);let e=a.children.map(t=>JSON.stringify(t));return E(a,e)}function p(a,e){return a==null||typeof a!="object"?!1:Object.hasOwnProperty.call(a,e)}function u(a,e,t,n,r=new Set){r.add(e.id),t.delete(e.id);let s=p(e,"replicaInfo")&&typeof e.replicaInfo=="object"&&e.replicaInfo;if(s&&p(s,"master")&&typeof s.master=="string"&&(r.has(s.master)||t.add(s.master)),n&&e.codeComponentIdentifier==="framer/Prototype"){let o=p(e,"$control__children")&&typeof e.$control__children=="object"&&e.$control__children;if(o&&(p(o,"type")&&o.type)==="componentinstance"){let h=p(o,"value")&&o.value;if(typeof h=="string"&&!r.has(h))t.add(h);else if(Array.isArray(h)){let l=h[0];(p(l,"type")&&l.type)==="componentinstance"&&typeof l.value=="string"&&(r.has(l.value)||t.add(l.value))}}}if(e.children)for(let o of e.children)u(a,o,t,n,r)}var D=class{constructor(e,{dependencies:t,mustBeVersion:n}={}){i(this,"shallowPageToChildrenStrings",new Map);i(this,"idToShallowPage",new Map);i(this,"dependencies");i(this,"chunkingHints",new Set);i(this,"idToParsedPage",new Map);i(this,"root");i(this,"version");P(I(e,1),"The passed document string is not parsable");let r=e.indexOf(c),s=T(e,0,r),o=JSON.parse(s+"}"),d=o.header;this.root=o.root,this.version=o.version??0,this.dependencies=t??[],n&&P(this.version===n,"The passed document has an invalid version"),P(d&&Array.isArray(d),"The header from the Byte Addressable document is missing"),P(this.root.__class,"The document is missing a shallow root and a __class property"),this.populateShallowPagesData(e,d,r+c.length),this.identifyLargePages(d)}getPagesToLoad(){let e=new Set;for(let t of this.idToShallowPage.keys())this.idToParsedPage.has(t)||e.add(t);return e}identifyLargePages(e){let t=0;for(let n of e){if(n>2e8){let r=this.root.children[t];r&&this.chunkingHints.add(r.id)}t++}}parsePage(e){if(this.idToParsedPage.has(e))return;let t=this.idToShallowPage.get(e);t&&this.parseShallowPage(t)}parseAndAnalyzePage(e,t,n,r){if(this.idToParsedPage.has(e))return;let s=this.idToShallowPage.get(e);if(!s){if(r)return;P(s,"page id does not match tracked shallow pages")}let o=this.parseShallowPage(s);u(o,o,t,n)}deconstructPageAndChildren(e,t,n){let r=e.indexOf(c,t);if(r<0||r>t+n)return[JSON.parse(e.slice(t,t+n)),""];let s=JSON.parse(T(e,t,r)),o=e.slice(r+c.length-1,t+n-1);return[s,o]}populateShallowPagesData(e,t,n){let r=n;for(let s of t){let[o,d]=this.deconstructPageAndChildren(e,r,s);this.root.children.push(o),this.idToShallowPage.set(o.id,o),this.shallowPageToChildrenStrings.set(o,d),r+=s+1}}parsePageWithChildren(e,t){return t.length>0&&(e.children=JSON.parse(t)),this.idToParsedPage.set(e.id,e),e}parseShallowPage(e){let t=this.idToParsedPage.get(e.id);if(t)return t;let n=this.shallowPageToChildrenStrings.get(e);if(n===void 0)throw Error("Shallow page is not available in the map");return this.parsePageWithChildren(e,n)}parseDependentPages(e){let t=new Set;for(let n of e){if(this.idToParsedPage.has(n))continue;let r=this.idToShallowPage.get(n);if(r){let s=this.parseShallowPage(r);u(s,s,t,!1);continue}for(let s of this.parsePagesContainingId(n))u(s,s,t,!1)}t.size>0&&this.parseDependentPages(t)}getHomePageNodeID(){if(p(this.root,"homePageNodeId")&&typeof this.root.homePageNodeId=="string")return this.root.homePageNodeId}getShallowPages(){return[...this.shallowPageToChildrenStrings.keys()]}getShallowPage(e){return this.idToShallowPage.get(e)}getPartialDocumentForPageIds(e){for(let n of b)this.parsePage(n);let t=new Set;for(let n of this.dependencies)this.parseAndAnalyzePage(n,t,!0,!0);for(let n of e)this.parseAndAnalyzePage(n,t,!0,!1);return this.parseDependentPages(t),this.root}getParsedPageById(e){let t=this.idToParsedPage.get(e);return t||this.parsePageWithId(e)}parsePageWithId(e){if(this.idToParsedPage.has(e))return null;let t=this.idToShallowPage.get(e);if(!t)return null;let n=this.shallowPageToChildrenStrings.get(t);return typeof n!="string"?null:this.parsePageWithChildren(t,n)}parseNextPage(){for(let[e,t]of this.shallowPageToChildrenStrings)if(!this.idToParsedPage.has(e.id))return this.parsePageWithChildren(e,t)}parsePagesContainingId(e){let t=[];for(let[n,r]of this.shallowPageToChildrenStrings)this.idToParsedPage.has(n.id)||w(r,e)&&t.push(this.parsePageWithChildren(n,r));return t}getPagesContainingId(e){if(this.idToShallowPage.has(e))return[e];let t=[];for(let[n,r]of this.shallowPageToChildrenStrings)w(r,e)&&t.push(n.id);return t}getChunkingHints(){return this.chunkingHints}};var x=300*1024*1024,y={ASCII:128,TWO_BYTE:224,TWO_BYTE_VALUE:192,THREE_BYTE:240,THREE_BYTE_VALUE:224,FOUR_BYTE:248,FOUR_BYTE_VALUE:240,CONTINUATION:192,CONTINUATION_VALUE:128},L=2155905152,S=4,g={QUOTE:34,BACKSLASH:92,OPEN_BRACE:123,CLOSE_BRACE:125,OPEN_BRACKET:91,CLOSE_BRACKET:93,COMMA:44,SPACE:32,TAB:9,NEWLINE:10,CARRIAGE_RETURN:13},m=new Uint8Array(256);m[g.SPACE]=1;m[g.TAB]=1;m[g.NEWLINE]=1;m[g.CARRIAGE_RETURN]=1;var C=class{constructor(e){i(this,"bytes");i(this,"u32View");this.bytes=e;let t=Math.floor(e.length/S);this.u32View=new Uint32Array(e.buffer,e.byteOffset,t)}scanUtf16UnitsToByteOffset(e,t){if(t===0)return e;let n=this.tryFastAsciiScan(e,t);if(n!==null)return n;let r=0,s=e;for(;r<t&&s<this.bytes.length;){let o=this.bytes[s];o<y.ASCII?(r++,s++):(o&y.TWO_BYTE)===y.TWO_BYTE_VALUE?(r++,s+=2):(o&y.THREE_BYTE)===y.THREE_BYTE_VALUE?(r++,s+=3):(o&y.FOUR_BYTE)===y.FOUR_BYTE_VALUE?(r+=2,s+=4):s++}return s}tryFastAsciiScan(e,t){if(e%S!==0)return null;let n=e/S,r=t,s=n;for(;r>=S&&s<this.u32View.length;)if((this.u32View[s]&L)===0)r-=S,s++;else return null;return r===0?s*S:null}},v=class{constructor(e){i(this,"bytes");i(this,"decoder",new TextDecoder);i(this,"encoder",new TextEncoder);i(this,"childrenKeyBytes",this.encoder.encode(c));i(this,"childrenKeyTable",null);this.bytes=e}parseJsonSlice(e,t){let n=this.bytes.subarray(e,t),r=this.decoder.decode(n);return JSON.parse(r)}parseShallowPage(e,t){return this.parsePageInternal(e,t,!1)}parseFullPage(e,t){return this.parsePageInternal(e,t,!0)}parsePageInternal(e,t,n){let r=this.indexOfPattern(this.childrenKeyBytes,e,t);if(r===-1)return this.parseJsonSlice(e,t);let s=r+this.childrenKeyBytes.length,o=this.parseShallowObject(e,s);if(n){let d=r+this.childrenKeyBytes.length-1,h=t-1;o.children=this.parseChildrenArray(d,h)}else o.children=[];return o}parseShallowObject(e,t){let n=this.bytes.subarray(e,t),r=this.decoder.decode(n)+"]}";return JSON.parse(r)}parseChildrenArray(e,t){return t-e<x?this.parseJsonSlice(e,t):this.parseChildrenByteLevel(e,t)}parseChildrenByteLevel(e,t){let n=[],r=e+1;for(;r<t&&m[this.bytes[r]]===1;)r++;for(;r<t-1&&this.bytes[r]!==g.CLOSE_BRACKET;){let s=r,o=0,d=!1,h=!1;for(;r<t;){let l=this.bytes[r];if(h)h=!1;else if(l===g.BACKSLASH)h=!0;else if(l===g.QUOTE&&!h)d=!d;else if(!d){if(l===g.OPEN_BRACE)o++;else if(l===g.CLOSE_BRACE&&(o--,o===0)){r++;break}}r++}if(r>s){let l=this.bytes.subarray(s,r),N=this.decoder.decode(l),B=JSON.parse(N);n.push(B)}r=this.skipCommaAndWhitespace(r,t)}return n}skipCommaAndWhitespace(e,t){for(;e<t;){let n=this.bytes[e];if(n===g.COMMA||this.isWhitespace(n))e++;else break}return e}isWhitespace(e){return m[e]===1}indexOfPattern(e,t,n){if(e.length===0)return t;if(e.length===1){for(let h=t;h<n;h++)if(this.bytes[h]===e[0])return h;return-1}let r;e===this.childrenKeyBytes?(this.childrenKeyTable||(this.childrenKeyTable=this.createBadCharTable(e)),r=this.childrenKeyTable):r=this.createBadCharTable(e);let s=n-t,o=e.length,d=0;for(;d<=s-o;){let h=o-1;for(;h>=0&&e[h]===this.bytes[t+d+h];)h--;if(h<0)return t+d;{let l=this.bytes[t+d+h],N=r[l]??-1;d+=Math.max(1,h-N)}}return-1}createBadCharTable(e){let t=new Int32Array(256);t.fill(-1);for(let n=0;n<e.length-1;n++){let r=e[n];r!==void 0&&(t[r]=n)}return t}},_=class{constructor(e,t={}){i(this,"bytes");i(this,"scanner");i(this,"jsonParser");i(this,"decoder",new TextDecoder);i(this,"encoder",new TextEncoder);i(this,"root");i(this,"version");i(this,"pageLengthsUtf16");i(this,"pageBoundaries",[]);i(this,"shallowPages",new Map);i(this,"parsedPages",new Map);i(this,"pageBoundaryMap",new Map);i(this,"dependencies");i(this,"chunkingHints",new Set);this.bytes=e,this.dependencies=t.dependencies??[],this.scanner=new C(e),this.jsonParser=new v(e);let{root:n,version:r,header:s,childrenStartByteOffset:o}=this.parseHeaderAndRoot();if(this.root=n,this.version=r,this.pageLengthsUtf16=s,t.mustBeVersion&&this.version!==t.mustBeVersion)throw new Error(`Version mismatch: expected ${t.mustBeVersion}, got ${this.version}.
                Document version does not match required version.`);this.calculatePageBoundaries(o),t.headerOnly||this.initializeShallowPages()}parseHeaderAndRoot(){let e=this.encoder.encode(c),t=this.jsonParser.indexOfPattern(e,0,this.bytes.length);if(t===-1)throw new Error(`Document format error: '${c}' key not found in ${this.bytes.length} byte document`);let n=t+e.length,r=this.bytes.slice(0,n),s=this.decoder.decode(r)+"]}}",o=JSON.parse(s);if(o.v!==1)throw new Error(`Invalid document version: expected ${1}, got ${o.v}
                Document may be from a different version or corrupted.`);if(!o.header||!Array.isArray(o.header))throw new Error(`Invalid document header: expected array, got ${typeof o.header}.
                Header contains page length information required for parsing.`);if(!o.root||typeof o.root!="object"||!o.root.__class)throw new Error(`Invalid document root: missing root object or __class property.
                Root: ${JSON.stringify(o.root).slice(0,100)}...`);return o.root.children=[],{root:o.root,version:o.version,header:o.header,childrenStartByteOffset:t+e.length}}calculatePageBoundaries(e){let t=e;for(let n=0;n<this.pageLengthsUtf16.length;n++){let r=this.pageLengthsUtf16[n],s=this.scanner.tryFastAsciiScan(t,r);s===null&&(s=this.scanner.scanUtf16UnitsToByteOffset(t,r));let o={pageIndex:n,startByteOffset:t,endByteOffset:s,utf16UnitLength:r};this.pageBoundaries.push(o),t=s+1}}initializeShallowPages(){for(let e of this.pageBoundaries){let t=this.jsonParser.parseShallowPage(e.startByteOffset,e.endByteOffset);this.shallowPages.set(t.id,t),this.pageBoundaryMap.set(t.id,e),this.root.children.push(t),e.utf16UnitLength>2e8&&this.chunkingHints.add(t.id)}}parseFullPage(e){if(this.parsedPages.has(e))return this.parsedPages.get(e)??null;let t=this.pageBoundaryMap.get(e);if(!t)return null;let n=this.jsonParser.parseFullPage(t.startByteOffset,t.endByteOffset);this.parsedPages.set(e,n);let r=this.root.children.findIndex(s=>s.id===e);return r!==-1&&(this.root.children[r]=n),n}getPagesToLoad(){let e=new Set;for(let t of this.shallowPages.keys())this.parsedPages.has(t)||e.add(t);return e}getHomePageNodeID(){if(p(this.root,"homePageNodeId")&&typeof this.root.homePageNodeId=="string")return this.root.homePageNodeId}getShallowPages(){return Array.from(this.shallowPages.values())}getShallowPage(e){return this.shallowPages.get(e)}getParsedPageById(e){let t=this.parsedPages.get(e);return t||this.parsePageWithId(e)}parsePageWithId(e){return this.parsedPages.has(e)?null:this.parseFullPage(e)??null}parseNextPage(){for(let[e,t]of this.shallowPages)if(!this.parsedPages.has(e))return this.parseFullPage(e)||void 0}getPagesContainingId(e){if(this.shallowPages.has(e))return[e];let t=[],n=this.encoder.encode(`"id":"${e}"`);for(let[r,s]of this.pageBoundaryMap)this.jsonParser.indexOfPattern(n,s.startByteOffset,s.endByteOffset)!==-1&&t.push(r);return t}parsePagesContainingId(e){let t=this.getPagesContainingId(e),n=[];for(let r of t){let s=this.parseFullPage(r);s&&n.push(s)}return n}getPartialDocumentForPageIds(e){for(let n of b)this.parseFullPage(n);let t=new Set;for(let n of this.dependencies){let r=this.parseFullPage(n);r&&u(r,r,t,!0)}for(let n of e){let r=this.parseFullPage(n);r&&u(r,r,t,!0)}return this.parseDependentPages(t),this.root}parseDependentPages(e){let t=new Set;for(let n of e){if(this.parsedPages.has(n))continue;let r=this.parseFullPage(n);if(r){u(r,r,t,!1);continue}for(let s of this.parsePagesContainingId(n))u(s,s,t,!1)}t.size>0&&this.parseDependentPages(t)}getChunkingHints(){return this.chunkingHints}};function U(a){let e=a.root,t=a.version,n=a.hash??0,r=e?.children;if(!r)return JSON.stringify(a);let{children:s,header:o}=H(r),d=E(e,s);return`{"v":${1},"header":${o},"version":${t},"hash":${n},"root":${d}}`}function H(a){let e=[],t=[];return a.forEach(n=>{let r=O(n);e.push(r),t.push(r.length)}),{children:e,header:JSON.stringify(t)}}export{b as a,I as b,D as c,_ as d,U as e};
//# sourceMappingURL=https://app.framerstatic.com/chunk-SE354WOV.mjs.map
