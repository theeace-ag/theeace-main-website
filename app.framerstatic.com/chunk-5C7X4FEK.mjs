import{a as v,b as w}from"https://app.framerstatic.com/chunk-6C6VSETA.mjs";import{e as y}from"https://app.framerstatic.com/chunk-FYUJQV6J.mjs";import{a as d,c as p,s as c,u as h,v as m,y as g}from"https://app.framerstatic.com/chunk-KYPY4QS7.mjs";var l=class r extends c{constructor(e){super(e,e)}map(e,t){let o=e.resolve(t.map(this.head));return r.valid(o)?new r(o):c.near(o)}content(){return p.empty}eq(e){return e instanceof r&&e.head==this.head}toJSON(){return{type:"gapcursor",pos:this.head}}static fromJSON(e,t){if(typeof t.pos!="number")throw new RangeError("Invalid input for GapCursor.fromJSON");return new r(e.resolve(t.pos))}getBookmark(){return new C(this.anchor)}static valid(e){let t=e.parent;if(t.isTextblock||!A(e)||!S(e))return!1;let o=t.type.spec.allowGapCursor;if(o!=null)return o;let n=t.contentMatchAt(e.index()).defaultType;return n&&n.isTextblock}static findGapCursorFrom(e,t,o=!1){e:for(;;){if(!o&&r.valid(e))return e;let n=e.pos,s=null;for(let i=e.depth;;i--){let a=e.node(i);if(t>0?e.indexAfter(i)<a.childCount:e.index(i)>0){s=a.child(t>0?e.indexAfter(i):e.index(i)-1);break}else if(i==0)return null;n+=t;let f=e.doc.resolve(n);if(r.valid(f))return f}for(;;){let i=t>0?s.firstChild:s.lastChild;if(!i){if(s.isAtom&&!s.isText&&!m.isSelectable(s)){e=e.doc.resolve(n+s.nodeSize*t),o=!1;continue e}break}s=i,n+=t;let a=e.doc.resolve(n);if(r.valid(a))return a}return null}}};l.prototype.visible=!1;l.findFrom=l.findGapCursorFrom;c.jsonID("gapcursor",l);var C=class r{constructor(e){this.pos=e}map(e){return new r(e.map(this.pos))}resolve(e){let t=e.resolve(this.pos);return l.valid(t)?new l(t):c.near(t)}};function A(r){for(let e=r.depth;e>=0;e--){let t=r.index(e),o=r.node(e);if(t==0){if(o.type.spec.isolating)return!0;continue}for(let n=o.child(t-1);;n=n.lastChild){if(n.childCount==0&&!n.inlineContent||n.isAtom||n.type.spec.isolating)return!0;if(n.inlineContent)return!1}}return!0}function S(r){for(let e=r.depth;e>=0;e--){let t=r.indexAfter(e),o=r.node(e);if(t==o.childCount){if(o.type.spec.isolating)return!0;continue}for(let n=o.child(t);;n=n.firstChild){if(n.childCount==0&&!n.inlineContent||n.isAtom||n.type.spec.isolating)return!0;if(n.inlineContent)return!1}}return!0}function M(){return new g({props:{decorations:D,createSelectionBetween(r,e,t){return e.pos==t.pos&&l.valid(t)?new l(t):null},handleClick:k,handleKeyDown:b,handleDOMEvents:{beforeinput:T}}})}var b=y({ArrowLeft:u("horiz",-1),ArrowRight:u("horiz",1),ArrowUp:u("vert",-1),ArrowDown:u("vert",1)});function u(r,e){let t=r=="vert"?e>0?"down":"up":e>0?"right":"left";return function(o,n,s){let i=o.selection,a=e>0?i.$to:i.$from,f=i.empty;if(i instanceof h){if(!s.endOfTextblock(t)||a.depth==0)return!1;f=!1,a=o.doc.resolve(e>0?a.after():a.before())}let x=l.findGapCursorFrom(a,e,f);return x?(n&&n(o.tr.setSelection(new l(x))),!0):!1}}function k(r,e,t){if(!r||!r.editable)return!1;let o=r.state.doc.resolve(e);if(!l.valid(o))return!1;let n=r.posAtCoords({left:t.clientX,top:t.clientY});return n&&n.inside>-1&&m.isSelectable(r.state.doc.nodeAt(n.inside))?!1:(r.dispatch(r.state.tr.setSelection(new l(o))),!0)}function T(r,e){if(e.inputType!="insertCompositionText"||!(r.state.selection instanceof l))return!1;let{$from:t}=r.state.selection,o=t.parent.contentMatchAt(t.index()).findWrapping(r.state.schema.nodes.text);if(!o)return!1;let n=d.empty;for(let i=o.length-1;i>=0;i--)n=d.from(o[i].createAndFill(null,n));let s=r.state.tr.replace(t.pos,t.pos,new p(n,0,0));return s.setSelection(h.near(s.doc.resolve(t.pos+1))),r.dispatch(s),!1}function D(r){if(!(r.selection instanceof l))return null;let e=document.createElement("div");return e.className="ProseMirror-gapcursor",w.create(r.doc,[v.widget(r.selection.head,e,{key:"gapcursor"})])}export{l as a,M as b};
//# sourceMappingURL=https://app.framerstatic.com/chunk-5C7X4FEK.mjs.map
